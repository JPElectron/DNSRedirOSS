<font face="Verdana" size="2">DNS Redirector - Full FAQ List<br>

<font face="Verdana" style="font-size: 10pt"><br>
&nbsp;[FAQ 4](#4) ListenOnIP error when starting the software<br>
&nbsp;[FAQ 5](#5) Block everything and allow just a few sites<br>
&nbsp;[FAQ 6](#6) Everything is blocked, but that is not my intention<br>
&nbsp;[FAQ 7](#7) Can't visit the real website after being redirected<br>
&nbsp;[FAQ 12](#12) How to flush DNS cache<br>
&nbsp;[FAQ 15](#15) Sites result in Page cannot be found<br>
&nbsp;[FAQ 24](#24) Unable to specify single DNS server on Linksys hardware<br>
&nbsp;[FAQ 25](#25) Broken images or links on the welcome page<br>
&nbsp;[FAQ 26](#26) Problems with multiple network cards<br>
&nbsp;[FAQ 27](#27) Use in a virtual server environment<br>
&nbsp;[FAQ 28](#28) Providing multiple DNS servers to clients<br>
&nbsp;[FAQ 32](#32) Not compatible with proxy server<br>
&nbsp;[FAQ 33](#33) Not compatible with Internet Connection Sharing<br>
&nbsp;[FAQ 34](#34) Prevent the use of other DNS servers<br>
&nbsp;[FAQ 35](#35) Known incompatible devices<br>
&nbsp;[FAQ 37](#37) Use when clients are behind a NAT device<br>
&nbsp;[FAQ 39](#39) Prevent the DNS Redirector server from attack<br>
&nbsp;[FAQ 40](#40) Use with OpenDNS<br>
&nbsp;[FAQ 49](#49) What makes DNS Redirector different/better?<br>
&nbsp;[FAQ 51](#51) Everything is allowed, but that is not my intention<br>
&nbsp;[FAQ 52](#52) Using updater.exe to automatically get new keywords<br>
&nbsp;[FAQ 54](#54) Use at a trade show<br>
&nbsp;[FAQ 56](#56) Catch-all page for multiple SSID or VPN hotspots<br>
&nbsp;[FAQ 57](#57) Keeping kids on track<br>
&nbsp;[FAQ 58](#58) Use during an emergency<br>
&nbsp;[FAQ 59](#59) Use for split DNS<br>
&nbsp;[FAQ 61](#61) Show the number of clients on LED digits<br>
&nbsp;[FAQ 62](#62) Get the IP or MAC of the client who just joined<br>
&nbsp;[FAQ 63](#63) Display a message on a Betabrite LED sign<br>
&nbsp;[FAQ 64](#64) Further customize OpenDNS<br>
&nbsp;[FAQ 65](#65) Best practices for speedy DNS resolution<br>
&nbsp;[FAQ 67](#67) Internet down, so show everyone a message<br>
&nbsp;[FAQ 70](#70) DNS Redirector software vs. SaaS or cloud offerings<br>
&nbsp;[FAQ 71](#71) Useful 3rd party links<br>
&nbsp;[FAQ 72](#72) Using 3rd party keywords<br>
&nbsp;[FAQ 75](#75) Create 3 tiers of blocking<br>
&nbsp;[FAQ 76](#76) Using the suggested blocked site in IIS<br>
&nbsp;[FAQ 77](#77) Logon script integration<br>
&nbsp;[FAQ 79](#79) What part of a URL is the domain name?<br>
&nbsp;[FAQ 86](#86) I found something really bad that wasn't blocked!<br>
&nbsp;[FAQ 89](#89) Use to enforce mobile users corporate security<br>
&nbsp;[FAQ 90](#90) Log only authorizations<br>
&nbsp;[FAQ 91](#91) Set Microsoft DNS service to a single IP<br>
&nbsp;[FAQ 92](#92) Set different DNS servers via Group Policy<br>
&nbsp;[FAQ 97](#97) Query the number of clients online via DNS<br>
&nbsp;[FAQ 99](#99) Enable AdminWhitelist function of the Blocked site<br>
&nbsp;[FAQ 100](#100) Enable BypassBlockADi function of the Blocked site<br>
&nbsp;[FAQ 101](#101) Client is instantly authorized, but that is not my intention<br>
&nbsp;[FAQ 102](#102) Allow DNS Redirector through any firewalls<br>
&nbsp;[FAQ 103](#103) Upgrade to DNS Redirector v7<br>
&nbsp;[FAQ 105](#105) Sites which do not exist are blocked<br>
&nbsp;[FAQ 106](#106) Use regular expressions in BlockedKeywordsFile<br>
&nbsp;[FAQ 107](#107) Problems with certain firewalls<br>
&nbsp;[FAQ 108](#108) Microsoft .NET Framework is required<br>
&nbsp;[FAQ 110](#110) Problems with certain routers<br>
&nbsp;[FAQ 111](#111) Using Log Parser with DNS Redirector<br>
&nbsp;[FAQ 112](#112) Use regular expressions in AllowedKeywordsFile<br>
&nbsp;[FAQ 113](#113) AP configuration in public wireless networks<br>
&nbsp;[FAQ 114](#114) Advert block list does not include some ccTLD's<br>
&nbsp;[FAQ 115](#115) Block sites from being accessed by IP address<br>
&nbsp;[FAQ 116](#116) Allow additional sites based on time of day<br>
&nbsp;[FAQ 117](#117) Use the same block page as OpenDNS<br>
&nbsp;[FAQ 118](#118) Provide alternate pages for phone/mobile device browsers<br>
&nbsp;[FAQ 120](#120) Enable MakeRequest function of the Blocked site<br>
&nbsp;[FAQ 121](#121) Useful AuthKeywordsFile additions<br>
&nbsp;[FAQ 123](#123) How to configure the SWMonDNSR Service<br>
&nbsp;[FAQ 124](#124) Software stops unexpectedly<br>
&nbsp;[FAQ 125](#125) Service will not install, or batch files will not run<br>
&nbsp;[FAQ 126](#126) Best practices for public networks<br>
&nbsp;[FAQ 128](#128) Time restriction options<br>
&nbsp;[FAQ 129](#129) NTFS permissions required<br>
&nbsp;[FAQ 137](#137) Use for self-guided tours<br>
&nbsp;[FAQ 138](#138) Non-payment notice<br>
&nbsp;[FAQ 139](#139) What to name your SSID<br>
&nbsp;[FAQ 142](#142) Valid DNS resolution paths<br>
&nbsp;[FAQ 143](#143) ClientTimeout setting explained<br>
&nbsp;[FAQ 145](#145) HTTPS website compatibility<br>
&nbsp;[FAQ 147](#147) Use with Remote Desktop Services (Terminal Services)<br>
&nbsp;[FAQ 148](#148) Quickly change your network preferences<br>
&nbsp;[FAQ 149](#149) Device Self-Registration<br>
&nbsp;[FAQ 150](#150) How to backup your DNS Redirector server<br>
&nbsp;[FAQ 152](#152) Problems with Server 2012 or 2016<br>
&nbsp;[FAQ 153](#153) Using the suggested welcome site in IIS<br>
&nbsp;[FAQ 154](#154) Show the number of clients on a LCD display<br>
&nbsp;[FAQ 156](#156) Change your DNS to obtain automatically<br>
&nbsp;[FAQ 157](#157) Monitor your DNS Redirector server with PRTG<br>
&nbsp;[FAQ 159](#159) Useful AllowedKeywordsFile additions<br>
&nbsp;[FAQ 160](#160) Why DNS Redirector doesn't produce graphical statistics<br>
&nbsp;[FAQ 161](#161) Dynamic DNS block list no longer includes URL redirect services<br>
&nbsp;[FAQ 162](#162) Special considerations for Apple devices<br>
&nbsp;[FAQ 163](#163) Force Google SafeSearch or no SSL<br>
&nbsp;[FAQ 164](#164) Set different DNS servers via DHCP MAC filtering<br>
&nbsp;[FAQ 165](#165) Use DHCP option 15 to set a DNS suffix<br>
&nbsp;[FAQ 166](#166) Not all sites are blocked correctly<br>
&nbsp;[FAQ 167](#167) Force Bing SafeSearch or Classroom<br>
&nbsp;[FAQ 168](#168) Microsoft .NET optimization high CPU<br>
&nbsp;[FAQ 169](#169) Length of the URL for this request error<br>
&nbsp;<br>

<br>
<br>
<br>

<a name="4"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 4: ListenOnIP error when starting the software</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
A) Another program or service running on the computer is using the same ports as DNS Redirector<br>
<br>
B) The value for ListenOnIP= in dnsredir.ini is not set to a valid system IP address<br>
<br>
An error might appear in any of the C:\DNSREDIR\DailyLogs files such as:<br>
\[Initialize\] Could not start listening on ...<br>
or<br>
\[Initialize\] DNS Redirector v7.x.x.x could not start ...<br>
<h4>Resolution</h4>
If Microsoft's DNS service, found on some internal DNS servers, such as your Active Directory (AD) Domain Controller (DC), is installed see <a href="full-FAQ.md#91">FAQ 91</a>.<br>
<br>
Check that the DNS Redirector service (dnsrsvc.exe) is not already running.<br>
<br>
Check that the value for ListenOnIP= in dnsredir.ini is set to an IP address actually assigned to the local NIC.<br>
<br>
In DNS Redirector v7 UDP port 53 must be free and other free ports will be dynamically allocated.<br>
In earlier versions UDP ports 53 and 3010 must be free.<br>
<br>
Use <a target="_blank" href="http://technet.microsoft.com/en-us/sysinternals/bb897437.aspx">tcpview</a> to find other software using the ports 
required by DNS Redirector. If other software is monopolizing these ports, try configuring that software to use a dedicated system IP address. 
Then specify a second system IP address and use it for the ListenOnIP= in dnsredir.ini 
(it is not necessary, nor advised, to add another NIC: Add multiple IP addresses to the same NIC under the Advanced button in TCP/IP properties)<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#32">FAQ 32</a> Not compatible with proxy server<br>
<a href="full-FAQ.md#33">FAQ 33</a> Not compatible with Internet Connection Sharing<br>

<br>
<br>
<br>

<a name="5"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 5: Block everything and allow just a few sites</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Block all websites and/or software that uses DNS to reach login servers/communicate (such as IM, chat, or email clients).<br>
<br>
Allow a list of <a href="full-FAQ.md#79">domain names</a> you choose.<br>
<h4>Resolution</h4>
Create a blocked.txt file and put just a . (period) in it on the first line, this blocks everything.<br>
<br>
If you've previously been using <a href="full-FAQ.md#52">updater.exe</a> you should delete it, and the scheduled task, 
so it doesn't run and replace your blocked.txt file.<br>
<br>
Create an allowed.txt file and add domains that clients may visit, one on each line...<br>
allowed.inside.example.com<br>
^(.*\.)?cnn\.com$&nbsp;&nbsp; ...allows browsers to visit http://cnn.com and http://www.cnn.com and http://money.cnn.com<br>
^(.*\.)?microsoft\.com$<br>
^.*\.msftncsi\.com$<br>
^(.*\.)?msftconnecttest\.com$&nbsp;&nbsp; ...see <a href="full-FAQ.md#159">FAQ 159</a><br>
^.*\.in-addr\.arpa$<br>
^update\.nai\.com$&nbsp;&nbsp; ...allows McAfee Virus Scan Enterprise updates via HTTP<br>
^ftp\.nai\.com$<br>
<br>
If client computers are part of a domain you will also want to allow your internal domain name(s) otherwise clients may have trouble reaching 
internal servers or experience very slow logon after CTRL+ALT+DEL. This domain name is shown under My Computer, right-click Properties, 
Computer Name tab, where it says Full computer name.<br>
The format is: computer-name.netbios-domain-name.domain.tld<br>
As an example: hp713.hq.contoso.com<br>
So you could add a plain keyword like: .hq.contoso.com<br>
or, a more secure regex keyword like: ^.*\.hq\.contoso\.com$<br>
<br>
You'll find some websites/software may need additional domains to function correctly, like their <a target="_blank" href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a> or partner sites.<br>
You can discover these other domains by:<br>
- setting Logging=Full in dnsredir.ini<br>
- restart DNS Redirector<br>
- clear your cache and visit the website, or start the software/update<br>
- look at today's logfile to see what else is required<br>
<br>
You may also want to allow other software update domains; virus scan definitions, Adobe, or Microsoft updates.<br>
<br>
Both of these files should be in the DNS Redirector working directory (usually C:\DNSREDIR) and specified in dnsredir.ini as:<br>
BlockedKeywordsFile=blocked.txt<br>
AllowedKeywordsFile=allowed.txt<br>
<br>
&nbsp;[ See a sample allowed file here: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">example-allowed.txt</a> ]<br>
Common/popular services and websites may use many domains, and rely on other <a target="_blank" href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a> domains. 
Incorporating this list can avoid disruption to services you know your company relies on. 
Remember that your internal domain suffix should also be included in your allowed file.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
You can make this keyword up and/or make it specific to your network's domain, for example: allowed.inside.example.com<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#75">FAQ 75</a> Create 3 tiers of blocking<br>
<a href="full-FAQ.md#159">FAQ 159</a> Useful AllowedKeywordsFile or AlwaysKeywordsFile additions<br>

<br>
<br>
<br>

<a name="6"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 6: Everything is blocked, but that is not my intention</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Every website you attempt to visit is blocked.<br>
<h4>Cause</h4>
The file specified for BlockedKeywordsFile= contains blank lines or spaces between keywords.<br>
<h4>Resolution</h4>
Check that your blocked.txt file contains keywords on every line, or otherwise a comment (line starting with the ; character) 
If there are any blank lines or spaces in the file, including any trailing at the end, you will experience this behavior.<br>
<br>
Add only domain names to this list, see <a href="full-FAQ.md#79">FAQ 79</a> for help identifying domain names.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#101">FAQ 101</a> Client is instantly authorized, but that is not my intention<br>
<a href="full-FAQ.md#51">FAQ 51</a> Everything is allowed, but that is not my intention<br>

<br>
<br>
<br>

<a name="7"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 7: Can't visit the real website after being redirected</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
After being redirected from a website or homepage, you can't visit that site normally.<br>
<h4>Cause</h4>
The browser may be caching the page.<br>
<br>
A DNS lookup for the real website is not done again until the browser is closed and opened.<br>
<h4>Resolution</h4>
Your welcome page(s) hosted at the RedirectIP= must contain all the no-cache meta tags as shown in the example pages.<br>
<br>
Implement the Cache-Control HTTP Header as described under <a href="full-ReadMe.md#sec6">Readme: Hosted Pages</a>.<br>
<br>
Since all modern browsers maintain their own DNS cache, the last page of your welcome site should include the message:<br>
"To begin surfing freely please close all browser windows"<br>
<br>
Restarting the browser flushes the cache of the redirected IP and forces the browser to do a DNS lookup for the site's real IP, 
the user's homepage or site they were trying to visit will then be accessible.<br>
<br>
When testing redirection on the same client machine repeatedly, the machine may cache DNS records which leads to confusion/not toggling authorization. 
See <a href="full-FAQ.md#12">FAQ 12</a> to flush the local machine's DNS cache or restart the computer between each test.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#35">FAQ 35</a>Known incompatible devices<br>

<br>
<br>
<br>

<a name="12"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 12: How to flush DNS cache</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
To flush your DNS cache follow <i>all</i> the steps below...<br>
<br>
A) close all Internet browsers (modern browsers maintain their own DNS cache)<br>
&nbsp;&nbsp; Ensure the browser is actually closed, just because you can't see the window doesn't mean it always closed,<br>
&nbsp;&nbsp; check task manager for running processes such as: iexplore.exe, firefox.exe, chrome.exe<br>
&nbsp;&nbsp; If you are using some other software that does a DNS lookup (such as a mail client [Outlook/Thunderbird], IM, VPN, remote desktop, game, etc.) close it as well.<br>
<br>
B) flush the local machine DNS cache (restarting the computer will also accomplish this)<br>
&nbsp;&nbsp; Windows: Start > Run > Type: cmd > Enter > Type: ipconfig /flushdns > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Mac OSX 10.4 (Tiger): Terminal<sup>(a)</sup> > Type: lookupd -flushcache > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Mac OSX 10.5 & 10.6 (Leopard): Terminal<sup>(a)</sup> > Type: sudo dscacheutil -flushcache > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Mac OSX 10.7 & 10.8 (Lion): Terminal<sup>(a)</sup> > Type: sudo killall -HUP mDNSResponder > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Mac OSX 10.9 (Mavericks): Terminal<sup>(a)</sup> > Type: dscacheutil -flushcache;sudo killall -HUP mDNSResponder > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Ubuntu/Lubuntu: Terminal window > Type: sudo service network-manager restart > Enter<sup>(b)</sup><br>
&nbsp;&nbsp; Most other Linux installs: Terminal window > Type: sudo /etc/init.d/nscd restart or: sudo /etc/init.d/networking restart > Enter<sup>(b)</sup><br>
<br>
C) if you have any internal DNS servers, such as your Active Directory (AD) Domain Controller (DC), flush the cache here also<br>
&nbsp;&nbsp; Windows: Control Panel > Administrative Tools > DNS > right-click on the server name, pick Clear Cache<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; or from the command-line by running: c:\windows\system32\dnscmd.exe . /clearcache<br>
<br>
<sup>(a)</sup> found in the dock, or in Finder > Applications > Utilities<br>
<sup>(b)</sup> after pressing Enter the command runs and the local DNS cache is cleared<br>
<br>
Note: Windows may require elevated privileges<br>
Start > All Programs > Accessories > right-click "Command Prompt" > select "Run as Administrator" > then type the command<br>
<br>
Note: It is not mandatory to manually clear the DNS cache, a change to your DNS Redirector allowed or blocked configuration will eventually take effect on all network clients, 
depending on the TTL of the DNS record it could be within minutes or several hours.<br>
<br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Legacy information provided for reference only: it is <u>not</u> suggested that you disable DNS cache...<br>
<br>
While disabling client DNS cache creates more DNS traffic across the LAN, it would ensure that all records get the most accurate/current resolve. 
You should take care in forcing this change only on computers under your direct control (within your company or organization).<br>
<br>
Windows 2000: <a target="_blank" href="http://support.microsoft.com/kb/245437">kb245437</a><br>
Windows XP/2003: <a target="_blank" href="http://support.microsoft.com/kb/318803">kb318803</a><br>
<br>
For more information on how DNS works <a target="_blank" href="http://www.microsoft.com/technet/prodtechnol/windows2000serv/plan/w2kdns2.mspx">read here</a>.<br>
<br>
Also see, How Internet Explorer uses the cache for DNS host entries: <a target="_blank" href="http://support.microsoft.com/kb/263558">kb263558</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#71">FAQ 71</a> Can't visit the real website after being redirected<br>

<br>
<br>
<br>

<a name="15"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 15: Sites result in &quot;Page cannot be found&quot;</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Visiting web pages results in a "Page cannot be found" or "This page can't be displayed" or "This webpage is not available" error, or web browsing is sometimes slow.<br>
<h4>Cause</h4>
If just blocked content ends up with this error, than either...<br>
 - no web server is running at the IP address specified for BlockedIP=<br>
 - the site is a HTTPS (secure) site<br>
 - the end-user device has obtained a IPv6 address, but the DNS Redirector server is not also reachable at an IPv6 address<br>
<br>
If all content ends up with this error, then either...<br>
 - the "real" DNS server specified for DNSServerIP= is invalid or unreachable<br>
 - a firewall is blocking UDP port 53 to/from the DNS Redirector server<br>
<h4>Resolution</h4>
 - Verify that you can visit the IP address specified for BlockedIP=<br>
As an example, if BlockedIP=192.168.0.2 in dnsredir.ini then ensure that you can visit http://192.168.0.2 directly in your browser. 
If you cannot visit the IP address specified then this error is the result of no website running at that IP address, TCP port 80 blocked by a firewall, 
website not running on TCP port 80, or missing web server configuration such as no default document and/or no custom error documents 
(as described under <a href="full-ReadMe.md#sec5">Readme: Hosted Pages</a>)<br>
<br>
 - Try visiting the site as http:// instead of https://<br>
Blocked sites are not reachable by either, although the blocked page is only displayed for http://<br>
This is expected, see <a href="full-FAQ.md#145">FAQ 145</a>.<br>
<br>
 - Disable IPv6 on the client device and/or turn off any IPv6 DHCP server on the network<br>
Otherwise you will need to assign a valid IPv6 address to the DNS Redirector server, and for ListenOnIP= in dnsredir.ini, 
and set that IPv6 address as the default DNS server that clients will use.<br>
<br>
 - Check that you have specified a working DNS server for DNSServerIP=<br>
As an example, if DNSServerIP=192.168.0.2 in dnsredir.ini then ensure this DNS server works and is reachable using <a target="_blank" href="http://support.microsoft.com/kb/200525">nslookup</a>.<br>
On corporate networks this is normally the IP of your internal or Active Directory (AD) DNS server, see <a href="full-FAQ.md#91">FAQ 91</a>.<br>
<br>
 - See <a href="https://drive.google.com/drive/folders/1JLL6UlbxI0sZy3610LfFa9Zk3g1tsDOY">DNS Test Instructions</a> to determine the fastest upstream DNS servers you should use.<br>
<br>
 - Ensure the DNS Redirector ListenOnIP= is the only DNS server used by client computers, see <a href="full-FAQ.md#28">FAQ 28</a><br>
 
<br>
<br>
<br>

<a name="24"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 24: Unable to specify single DNS server on Linksys hardware</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Although <a target="_blank" href="http://www.linksys.com">Linksys</a> devices will allow you to specify an internal IP for the DNS server, 
the unit may give out additional DNS servers to LAN clients via DHCP. 
DNS Redirector must be the sole DNS server used by clients.<br>
<h4>Cause</h4>
The Linksys device is attempting to be helpful by providing additional DNS servers for redundancy. 
The other DNS servers are being populated from the WAN/Internet interface, which usually indicates an ISP connection with a dynamic IP.<br>
<h4>Resolution</h4>
Method 1: Specify the IP you have in ListenOnIP= for all 3 DNS Server IP fields on the Linksys admin page, leaving none of them with 0.0.0.0 or blank.<br>
<br>
Method 2: Give the machine running DNS Redirector 3 IP addresses, for example 192.168.0.2, ...0.3, and ...0.4,<br>
leave ListenOnIP= set blank which will cause DNS Redirector to listen for DNS queries on every system IP address,<br>
then specify 192.168.0.2, ...0.3, and ...0.4 in the DNS Server IP fields on the Linksys admin page.<br>
<br>
Method 3: Disable or turn off DHCP service in the Linksys device and use 
<a target="_blank" href="http://technet.microsoft.com/en-us/network/bb643151.aspx">Microsoft's DHCP</a> service available on any server OS.<br>
<br>
Method 4: Use an alternative firmware on the Linksys device such as <a target="_blank" href="http://www.polarcloud.com/tomato">Tomato</a> or 
<a target="_blank" href="http://www.dd-wrt.com">DD-WRT</a>.<br>
<br>
Method 5: Use a different firewall/router.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#28">FAQ 28</a> Providing multiple DNS servers to clients<br>
<a href="full-FAQ.md#35">FAQ 35</a> Known incompatible devices<br>

<br>
<br>
<br>

<a name="25"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 25: Broken images or links on the welcome page</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
After being redirected from a website or homepage, your welcome/splash page appears but images don't load or links to other pages don't work correctly.<br>
<h4>Cause</h4>
You need to hard-code the full path to your images and links using the RedirectIP= in the URL.<br>
<h4>Resolution</h4>
As an example, if RedirectIP=192.168.20.9 than an image src path must contain the full URL of "http://192.168.20.9/images/yourimage.gif" or a link to another page should be "http://192.168.20.9/page2.htm"<br>
<br>
Avoid using relative paths like "/images/yourimage.gif"<br>
<br>This ensures compatibility regardless of the homepage the user has set in their browser.<br>

<br>
<br>
<br>

<a name="26"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 26: Problems with multiple network cards</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7 is supported with multiple network cards, assuming ListenOnIP= is set to one or more valid IP addresses that are assigned to 
the NICs (meaning ListenOnIP= should not be left blank and/or not set to the loopback address of 127.0.0.1)<br>
<br>
The registry setting IPEnableRouter can be used, but DNS Redirector support cannot assist with this function.<br>
Windows 2003: <a target="_blank" href="http://support.microsoft.com/kb/323339">kb323339</a><br>
Windows XP: <a target="_blank" href="http://support.microsoft.com/kb/315236">kb315236</a><br>
<br>
A bridged connection between two network cards, such as Windows 2000/XP's Internet Connection Sharing (or ICS) is not compatible with any version of DNS Redirector.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#33">FAQ 33</a> Not compatible with Internet Connection Sharing<br>

<br>
<br>
<br>

<a name="27"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 27: Use in a virtual server environment</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector is supported running on a virtual machine when the machine has a mapped network card and dedicated/static IP address (no Shared networking or NAT).<br>
<br>
You should specify a static MAC address for the virtual NIC of the virtual machine.<br>
<br>
When running multiple instances of DNS Redirector for redundancy you increase your success over single point of failure incidents when the virtual 
machines exist on separate physical servers. For example, if the one physical server that hosts two virtual machines running DNS Redirector were 
to fail then DNS resolution would not work.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#28">FAQ 28</a>Providing multiple DNS servers to clients<br>

<br>
<br>
<br>

<a name="28"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 28: Providing multiple DNS servers to clients</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You might want to provide a second, or third, DNS server to network clients for redundancy or fault-tolerance. 
All DNS server's provided to clients should be DNS Redirector servers.<br>
<br>
Note that client computers may randomly switch to an alternate DNS server, even when the primary is available and ready. 
For this reason...<br>
<br>
- When implemented for filtering (BlockedIP= setting, as in most corporate environments) every DNS server provided to clients must be a DNS Redirector 
server (ideally running on physically different hardware for true redundancy).<br>
<br>
- When implemented for captive portal (RedirectIP= setting, as in most HotSpot environments) one server running DNS Redirector <u>must</u> be the 
only DNS server provided to network clients via DHCP. This is necessary so DNS Redirector can track all clients joining/leaving the network. The only 
exception is; if a load balancer can direct clients to the same DNS Redirector server every time and only switch servers after one is found down.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#27">FAQ 27</a> Use in a virtual server environment<br>
<a href="full-FAQ.md#24">FAQ 24</a> Unable to specify single DNS server on Linksys hardware<br>

<br>
<br>
<br>

<a name="32"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 32: Not compatible with proxy server</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector cannot be used when client machines are required to have proxy or Socks server information set in order to surf the Internet.<br>
<br>
DNS Redirector cannot be used with a "transparent" proxy, such as provided by IPCop.<br>
<h4>Cause</h4>
Traffic destined for the Internet is sent to the proxy server, rather than the standard ports 80 for HTTP and 53 for DNS.<br>
<h4>Resolution</h4>
See <a href="https://drive.google.com/drive/folders/1KNDQZk0YMj6DSHv7fAJYGYBwAFhcyvd8">Network Examples</a> to implement DNS Redirector with a firewall/router as the default gateway.<br>
<br>
DNS Redirector could be implemented to display a message or provide instructions in the browser (via a redirect or catch-all blocked page) 
to inform users who do not have proxy information setup that proxy settings are required.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#4">FAQ 4</a> ListenOnIP error when starting the software<br>
<a href="full-FAQ.md#35">FAQ 35</a> Known incompatible devices<br>

<br>
<br>
<br>

<a name="33"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 33: Not compatible with Internet Connection Sharing</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector cannot be used with Internet Connection Sharing (commonly known as ICS) 
which acts as a NAT router between two network interfaces in the same machine.<br>
<h4>Cause</h4>
ICS monopolizes UDP port 53 to forward DNS queries out the WAN (Internet) interface. 
There is no way to configure ICS to specify a separate DNS server for users on the LAN (Inside) interface.<br>
<br>
See <a target="_blank" href="http://support.microsoft.com/kb/250603">kb250603</a><br>
<h4>Resolution</h4>
See <a href="https://drive.google.com/drive/folders/1KNDQZk0YMj6DSHv7fAJYGYBwAFhcyvd8">Network Examples</a> to implement DNS Redirector with a firewall/router as the default gateway.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#4">FAQ 4</a> ListenOnIP error when starting the software<br>
<a href="full-FAQ.md#26">FAQ 26</a> Problems with multiple network cards<br>

<br>
<br>
<br>

<a name="34"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 34: Prevent the use of other DNS servers</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Create a rule in the firewall/router to the Internet that prevents everything but the DNS Redirector server from communicating outbound over TCP/UDP port 53 and 5353.<br>
<br>
This prevents a user who deliberately changed their DNS server from bypassing your blocked list or getting out on the Internet.<br>
<br>
In a hotspot environment, realize this rule may result in the occasional call to your support/helpdesk 
(the solution is always to have the user change their network adapter to "obtain automatically" for both IP address and DNS server). 
Implementing this rule will ensure that all users see your welcome site.<br>

<h4>Resolution</h4>
<u>On a Cisco PIX or ASA firewall the relevant configuration lines are...</u><br>
(in this example ListenOnIP=192.168.0.2 in dnsredir.ini)<br>
access-list inside_access_in permit tcp host 192.168.0.2 any eq domain<br>
access-list inside_access_in permit udp host 192.168.0.2 any eq domain<br>
access-list inside_access_in deny tcp any any eq domain<br>
access-list inside_access_in deny udp any any eq domain<br>
access-list inside_access_in deny tcp any any eq 5353<br>
access-list inside_access_in deny udp any any eq 5353<br>
access-group inside_access_in in interface inside<br>
dhcpd dns 192.168.0.2<br>
write mem<br>
<br>
<u>On the <a target="_blank" href="http://www.zyxel.com">ZyXEL</a> ZyWALL USG series of firewalls go to...</u><br>
(in this example ListenOnIP=192.168.3.2 in dnsredir.ini which is assigned the name "lan1_dnsredir" under Object, Address)<br>
Gears > Firewall<br>
See screenshot of <a target="_blank" href="/sample/Zyxel/ZyWallUSG_ Firewall_ Rules.png">this ZyWALL USG config</a><br>
<br>
<u>On the <a target="_blank" href="http://www.netgear.com">Netgear</a> FVS series of firewalls go to...</u><br>
(in this example ListenOnIP=192.168.2.2 in dnsredir.ini)<br>
Security > Firewall > LAN WAN rules (or DMZ WAN rules, depending on which interface your using)<br>
See screenshot of <a target="_blank" href="/sample/Netgear/NetgearFVS_ Firewall_ Rules _Outbound-method1.gif">the Netgear best method</a> (blocking everything except the DNS Redirector server)<br>
See screenshot of <a target="_blank" href="/sample/Netgear/NetgearFVS_ Firewall_ Rules _Outbound-method2.gif">the Netgear alternate method</a> (blocking just the range of IPs in the DHCP pool)<br>
<br>
<u>On a Linksys or other device with alternative firmware <a target="_blank" href="http://www.polarcloud.com/tomato">Tomato</a> go to...</u><br>
(in this example ListenOnIP=192.168.1.2 in dnsredir.ini)<br>
Access Restriction > Add<br>
Enabled: Check<br>
Description: NoOtherDNS<br>
Schedule: Check All Day, Check Everyday<br>
Type: Normal Restriction<br>
Applies To: All Except, 192.168.1.2<br>
Blocked Resources: Uncheck Block All Internet Access<br>
Add Rule: TCP/UDP, Dst Port, 53<br>
IPP2P (disabled), Layer 7 (disabled)<br>
OK<br>
Add Rule: TCP/UDP, Dst Port, 5353<br>
IPP2P (disabled), Layer 7 (disabled)<br>
OK<br>
Save<br>
See screenshot of <a target="_blank" href="/sample/Tomato/Tomato_ Edit Access Restrictions_ NoOtherDNS.pdf">this Tomato config</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#115">FAQ 115</a> Block sites from being accessed by IP address<br>

<br>
<br>
<br>

<a name="35"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 35: Known incompatible devices</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
<b>Network device (firewall/router) limitations...</b><br>
<br>
- Any Microsoft branded home wireless routers<br>
Reason: Cannot set DHCP so clients get the DNS Redirector server IP as their sole DNS server, 
the device insists on handing out the ISP's DNS servers.<br>
<br>
- ASUS RT-N66U (Wireless-N900) <font face="Verdana" style="font-size: 8.5pt"> <sup>1, 2</sup></font><br>
Reason: Cannot set DHCP so clients get the DNS Redirector server IP as their sole DNS server, 
the device insists on handing out itself (default gateway address) in addition to the DNS server(s) defined.<br>
<br>
- Belkin 1N Vision (F5D8232-4)<br>
Reason: Cannot set DHCP so clients get the DNS Redirector server IP as their sole DNS server, 
the device insists on handing out the ISP's DNS servers.<br>
<br>
- Belkin Share Max N300 Wireless N+ Router (F7D7301)<br>
Reason: Cannot disable DNS Masquerading, the device insists on capturing all outbound DNS queries, 
as explained in <a href="full-FAQ.md#110">FAQ 110</a>.<br>
<br>
- Netgear WNDR3300, WNDR3400, WNR2000 <font face="Verdana" style="font-size: 8.5pt"> <sup>1</sup></font><br>
Reason: Cannot disable DNS Masquerading, the device insists on capturing all outbound DNS queries, 
as explained in <a href="full-FAQ.md#110">FAQ 110</a>.<br>
<br>
- Linksys WRT160N <font face="Verdana" style="font-size: 8.5pt"> <sup>1, 2</sup></font><br>
Reason: Cannot disable DNS Masquerading, the device insists on capturing all outbound DNS queries, 
as explained in <a href="full-FAQ.md#110">FAQ 110</a>.<br>
<br>
- Linksys AC1750 <font face="Verdana" style="font-size: 8.5pt"> <sup>1</sup></font><br>
Reason: Cannot set DHCP so clients get the DNS Redirector server IP as their sole DNS server, 
the device insists on handing out itself (default gateway address) in addition to the DNS server(s) defined.<br>
<br>
<font face="Verdana" style="font-size: 8.5pt"> <sup>1</sup></font> indicates a possible workaround: 
Disable DHCP on the router, instead run a DHCP service on the server running DNS Redirector.<br>
<font face="Verdana" style="font-size: 8.5pt"> <sup>2</sup></font> indicates a possible workaround: 
Use an alternative firmware such as <a target="_blank" href="http://www.polarcloud.com/tomato">Tomato</a> 
or <a target="_blank" href="http://www.dd-wrt.com">DD-WRT</a> and disable <a href="full-FAQ.md#110">DNS Masquerading</a>.<br>
&nbsp; Note that using an alternative firmware may reduce performance or even brick the router, proceed at your own risk.<br>
&nbsp; Our support team cannot assist and will recommend <font face="Verdana" style="font-size: 8.5pt"><sup>1</sup></font> above or tell you to buy a true business-grade firewall.<br>
<br>
<b>Mobile device (phone/tablet) limitations...</b><br>
<br>
- If the browser homepage is set to a local file or a site only available on the cellular network, the user will not see your welcome site (implemented via DNS Redirector) until they browse to an Internet site.<br>
- If the cellular carrier (or a corporate policy applied to the device) prefers the cellular network over locally available WiFi, the user may not see your welcome site (implemented via DNS Redirector) unless the device is put in airplane mode (where the cellular radio is turned off).<br>
- For Windows CE devices (Windows Mobile 6 and earlier) after authorization by DNS Redirector users may not be able to browse back to their set home page until the browser is quit/end task (from task manager, or by rebooting the device).  This is because simply "closing" an application (or going back to the main screen) doesn't terminate the application, it is still running in the background and the DNS cache is not flushed until the browser is quit.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#110">FAQ 110</a> Problems with certain routers<br>
<a href="full-FAQ.md#32">FAQ 32</a> Not compatible with proxy server<br>
<a href="full-FAQ.md#24">FAQ 24</a> Unable to specify single DNS server on Linksys hardware<br>
<a href="full-FAQ.md#7">FAQ 7</a> Can't visit the real website after being redirected<br>

<br>
<br>
<br>

<a name="37"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 37: Use when clients are behind a NAT device</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
For all features to be supported the DNS Redirector server cannot be separated from clients by a NAT device.<br>
This is because all clients behind a NAT device are only seen as one IP (the outside/WAN interface).<br>
<br>
When used for Internet filtering only (BlockedIP= setting, as in corporate environments)...<br>
Blocked/allowed functionality will work regardless of network placement. However, options such as BypassBlockFile= 
should not be used. Realize if you configure the option to bypass the block, doing so would apply to the entire network behind the NAT device 
(because DNS Redirector sees any client inside that network as all coming from one IP address)<br>
<br>
When used for Captive portal (RedirectIP= setting, as in HotSpot environments)...<br>
The machine running DNS Redirector and all network clients <i>cannot</i> be separated by a NAT device. Multiple subnets are acceptable. It is necessary that DNS Redirector track clients joining and leaving the network, each by their unique IP address.<br>
<br>
When implemented with a catch-all * record (such as during a network emergency, closed network, or a network without access to the Internet) this function will will work regardless of network placement.<br>
<br>
See Network Examples<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#142">FAQ 142</a> Valid DNS resolution paths<br>

<br>
<br>
<br>

<a name="39"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 39: Prevent the DNS Redirector server from attack</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
On any network there is the potential for hostile or abusive users.<br>
<h4>Resolution</h4>
At the least, you should 'harden the machine' by disabling unnecessary functions such as...<br>
 - Client for Microsoft Networks (under NIC properties)<br>
 - QoS Packet Scheduler (under NIC properties)<br>
 - File and Printer Sharing (under NIC properties)<br>
 - SSDP Discovery (Service)<br>
 - TCP/IP NetBIOS Helper (Service)<br>
 - "Universal Plug and Play Device Host" or "UPnP Device Host" (Service)<br>
 - Wireless Zero Configuration (Service) ...the DNS Redirector server should be hard-wired to the network, not wireless<br>
<br>
Place a firewall (preferably hardware based, no NAT) between clients and the DNS Redirector server, 
allowing only UDP 53 (for DNS) and TCP 80 (for IIS) inbound to the server, see <a href="full-FAQ.md#142">FAQ 142</a> and <a href="full-FAQ.md#37">FAQ 37</a>.<br>
<br>
Use TCP/IP filtering (in Windows <a target="_blank" href="http://support.microsoft.com/kb/309798">2000</a> / 
<a target="_blank" href="http://support.microsoft.com/kb/816792">2003</a>) or Windows Firewall.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#102">FAQ 102</a> Allow DNS Redirector through any firewalls<br>

<br>
<br>
<br>

<a name="40"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 40: Use with OpenDNS</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
For everything to work as expected, <a target="_blank" href="http://www.opendns.com">OpenDNS</a> must be last in the chain that DNS requests are forwarded to. 
Wherever you would normally specify your ISP's DNS Server(s) you can substitute and use OpenDNS.<br>
<h4>Cause</h4>
In some corporate environments, incorrectly specifying a OpenDNS server for DNSServerIP= in dnsredir.ini may result in loss of connectivity to 
internal servers, Intranet's, or impede the ability to logon to a Windows NT or Active Directory (AD) based domain (very slow logon after CTRL+ALT+DEL).<br>
<h4>Resolution</h4>
Depending on your implementation, DNS should work like this...<br>
<br>
Public HotSpot:<br>
Client laptop > DNS Redirector > OpenDNS<br>
<br>
Corporate LAN:<br>
Client workstation > DNS Redirector > Internal/Active Directory DNS > OpenDNS<br>
<br>Note that because of the way OpenDNS works (features such as typo correction, and search suggestions for mispelled or even non-existant domains) 
<u>all</u> DNS lookups resolve and are pingable. Realize that in some cases this is really the OpenDNS web server responding and not the true 
target/destination of the lookup.<br>
<br>
Note: After 9 years OpenDNS <a target="_blank" href="http://blog.opendns.com/2014/05/29/no-more-ads/">has finaly conceded</a> that ads and security don't mix, 
as a result there is no guide page and you will get NXDOMAIN and SERVFAIL responses, therefore some information in this article is no longer applicable.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#64">FAQ 64</a> Further customize OpenDNS<br>
<a href="full-FAQ.md#105">FAQ 105</a> Sites which do not exist are blocked<br>
<a href="full-FAQ.md#117">FAQ 117</a> Use the same block page as OpenDNS<br>

<br>
<br>
<br>

<a name="49"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 49: What makes DNS Redirector different/better?</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The provided blocking keywords contain data from over 18 different sources and include predictive blocking. 
For example; the keyword "antivir" prevents scare-ware and ransom-ware that appear to offer virus scan software, 
and the keyword "xxx" prevents access to pornography. 
These two keywords alone block thousands of sites and provide future protection against domains that aren't even registered yet. 
Greatly improve network security by blocking <a href="full-FAQ.md#106">ccTLD's and GeoTLD's</a> that are not relevant to your business. 
Other products require huge lists of fully qualified domain names to block, and/or subscription fees. 
Our list are provided free-of-charge to all users of DNS Redirector.<br>
<br>
The welcome, blocked, or other pages implemented by DNS Redirector can be served by IIS, Apache, 
or any industry standard web server software you choose; allowing limitless customization of your pages and authorization process. 
Other products/SaaS offerings require use of their own web server or are branded with advertisements.<br>
<br>
Nothing needs to be modified, installed, or set on client computers that already use DHCP.<br>
<br>
DNS Redirector only manipulates DNS and nothing else; this keeps network access speed as fast as possible. 
Other products use a proxy and/or proprietary MAC address rules; which can slow or even prevent access depending on browser settings, 
security toolbars, corporate VPN software, or personal firewall software.<br>
<br>
Unlike other products that release weekly/monthly patches; DNS Redirector just plain works and at an affordable price.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#70">FAQ 70</a> DNS Redirector software vs. SaaS or cloud offerings<br>

<br>
<br>
<br>

<a name="51"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 51: Everything is allowed, but that is not my intention</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Every website you visit is allowed (not blocked).<br>
<h4>Cause</h4>
The file specified for AllowedKeywordsFile= contains blank lines or spaces between keywords.<br>
<h4>Resolution</h4>
Check that your allowed.txt file contains keywords on every line, or otherwise a comment (line starting with the ; character)  If there are any blank lines or spaces in the file, including any trailing at the end, you will experience this behavior.<br>
<br>
Add only domain names to this list, see <a href="full-FAQ.md#79">FAQ 79</a> for help identifying domain names.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#6">FAQ 6</a> Everything is blocked, but that is not my intention<br>
<a href="full-FAQ.md#101">FAQ 101</a> Client is instantly authorized, but that is not my intention<br>
<a href="full-FAQ.md#166">FAQ 166</a> Not all sites are blocked correctly<br>

<br>
<br>
<br>

<a name="52"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 52: Using updater.exe to automatically get new keywords</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Updater has moved to GitHub, please see: <a href="https://github.com/JPElectron/DNSRedirOSSUpdater">https://github.com/JPElectron/DNSRedirOSSUpdater</a><br>

<br>
<br>
<br>

<a name="54"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 54: Use at a trade show</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In 2005 a customer wanted to demo his web-based project management software. He had a booth at a local convention center for 2 days, 
but they wanted $100/hour for an ISDN Internet connection.<br>
<br>
Instead, he loaded an offline copy of the website onto a spare desktop which acted as the server, 
this was connected to a wireless access point with the SSID "freewireless" 
He had 3 laptops on tables at the front of the booth so people could try out his site. 
In addition to those laptops connecting wirelessly he left the access point open for anyone else to find, and people did. 
Using DNS Redirector's SimpleDNS= file with an asterisk record; thereby resolving any DNS lookup (any attempt to visit a website) 
to the local web server - all without a real Internet connection. The default document and custom error pages redirected to a page 
explaining the user should click here to start a demo of the product and/or come to booth 285 for more details.<br>
<br>
A few days later the customer told DNS Redirector staff that "at least 30 people came by" the booth as a result of connecting to 
"freewireless" and learning about the product. That's 30 individuals who might not have otherwise discovered it. The people at the 
next booth were also very jealous that he didn't pay the outrageous price for a real Internet connection.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#159">FAQ 159</a> Useful AllowedKeywordsFile or AlwaysKeywordsFile additions<br>

<br>
<br>
<br>

<a name="56"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 56: Catch-all page for multiple SSID or VPN hotspots</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In some instances you may use multiple SSIDs, VLANs, or a VPN client for wireless network security. DNS Redirector can facilitate providing 
instructions or a download page to end-users who associate with the first open/publicly accessible SSID on how to connect to the second 
SSID or via VPN.<br>
<br>
On the 1st/open network, hand out the DNS Redirector ListenOnIP= as the default DNS server for all associated clients to obtain via DHCP. 
Use the SimpleDNS= function with an asterisk record pointing to the IP of a website in IIS where you will provide instructions on downloading 
and connecting via VPN, or associating to another SSID. When any user opens their browser and tries to visit a website, they'll instead be 
redirected to your site with instructions. Any other Internet dependant applications, such as IM or email, will be unavailable. 
An active Internet connection or upstream DNS server(s) specified in DNSServerIP= is not required for this functionality.<br>
<br>
On the 2nd/private network, you might use a separate instance of DNS Redirector to restrict/filter Internet activity, or ensure that the user 
cannot reach some sites without first being connected via VPN (thereby using a different, internal, DNS server).<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#54">FAQ 54</a> Use at a trade show<br>

<br>
<br>
<br>

<a name="57"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 57: Keeping kids on track</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You might use DNS Redirector to prevent children from getting distracted before or after school. Perhaps set it so Internet access isn't available 
during bedtime, or when your not home to supervise. This is in addition to the BlockedIP= function for filtering out inappropriate material. 
You might run DNS Redirector on an extra PC in the basement or a locked computer in your office, with nothing running directly on their 
laptop/desktop there is nothing for them to tamper with or disable.<br>
<br>
For older kids you might allow them more freedom on the Internet but then set Logging=Full so you can check what sites their visiting, 
or choose to restrict just a handful of known risky sites.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#128">FAQ 128</a> Time restriction options<br>
<a href="full-FAQ.md#116">FAQ 116</a> Allow additional sites based on time of day<br>

<br>
<br>
<br>

<a name="58"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 58: Use during an emergency</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
If you provide DNS service across your school or collage campus using DNS Redirector you could easily convey important information in case of emergency. 
Even if you don't implement RedirectIP= or BlockedIP= functions for every-day use, you could easily enable the RedirectIP= function as part of your 
emergency action plan.<br>
<br>
For example, if there were important security or class cancellation information you wanted to convey, you would enable RedirectIP= to point to that 
site, or perhaps redirect to your school's homepage. Simply restart DNS Redirector and the change would be active. Any user who launches thier browser 
or surfs to a site they haven't visited recently would then be redirected to your information page.<br>
<br>
You could enable users to continue surfing past this information page by asking them to type a special code, or click 
a 'I confirm I have read this notice' button, thereby triggering authorization. When the emergency is over, you would remove the RedirectIP= 
and AuthKeywordsFile= settings, restart DNS Redirector, and continue using it only as a typical DNS forwarding server.<br>
<br>
Another method might be to capture all outbound DNS traffic (UDP port 53) at your perimeter firewall/router using rules or ACLs, and redirect it to 
the DNS Redirector server IP during the emergency.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#67">FAQ 67</a> Internet down, so show everyone a message<br>

<br>
<br>
<br>

<a name="59"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 59: Use for split DNS</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Also referred to as <a target="_blank" href="http://en.wikipedia.org/wiki/Split-horizon_DNS">split-horizon DNS</a>, split-view DNS, or split-brain DNS.<br>
<br>
Example: The server mail.example.com is located inside your LAN or in a DMZ, but your external DNS only answers with the external IP address. 
You might need to answer with the internal/private IP so computers inside your LAN can reach the resource. 
This is commonly accomplished by duplicating the entire DNS zone on an internal DNS server, or by using dns fixup commands on Cisco PIX/ASA firewalls. 
Managing a separate DNS server internally or using different firewall hardware may be cost prohibitive, using DNS Redirector with the SimpleDNS= 
function may be the alternative you're looking for.<br>
<br>
You'll leave mail.example.com pointing to the external IP at your public/name servers, but declare mail.example.com to resolve to the inside IP in 
SimpleDNS=simpledns.txt<br>
<br>
Only this record will be manipulated when looked up through DNS Redirector, all other domain records will still be resolved by the external name server.<br>

<br>
<br>
<br>

<a name="61"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 61: Show the number of clients on LED digits</h3><font size=1>Category: Action functions</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The LED digits can be used to display the number of clients online.<br>
<br>
Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">JoinAction-leddigit.zip</a> v2.0.0.0 r06/09/2010<br>
Extract to the same folder as your DNS Redirector installation<br>
<br>
Modify count.ini as follows:<br>
ComPort=COM1&nbsp;&nbsp; ...serial port that the LED digits are connected to<br>
Digits=2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...how many LED digits; default is 2 or the max is 6<br>
<br>
Modify dnsredir.ini as follows:<br>
ActionNumber=1<br>
JoinAction=C:\DNSREDIR\count.exe<br>
LeaveAction=C:\DNSREDIR\count.exe<br>
<br>
When connecting to any other computer you could use a Scheduled Task on that computer to run count.exe every 10 minutes, or<br>
define JoinAction= and LeaveAction= on the server to run a .bat which could use <a target="_blank" href="http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx">psexec.exe</a> to run count.exe on the remote machine.<br>

<br>
<br>
<br>

<a name="62"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 62: Get the IP or MAC of the client who just joined</h3><font size=1>Category: Action functions</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">JoinAction-variables.zip</a> and extract to the C:\DNSREDIR working directory.<br>
<br>
In this example, every join action triggers the client's MAC and IP address to be logged in C:\DNSREDIR\joinlog.txt<br>
<br>
The IP is passed as variable %1 when JoinAction or LeaveAction is run<br>
The MAC is obtained from the arp command and set in the variable %MAC%<br>
<br>
Retaining the MAC address and IP may be useful to law enforcement, to determine abuse or violation of network policies.<br>
<br>
One customer developed a script so after a client joined multiple access points where polled via SNMP, determining which AP the client associated with gave an idea of where they were in the building.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#90">FAQ 90</a> Log only authorizations<br>

<br>
<br>
<br>

<a name="63"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 63: Display a message on a Betabrite LED sign</h3><font size=1>Category: Action functions</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In this sample we use a 3rd party software program called kitchi to display information on the sign after a client has joined or left the network...<br>
<br>
More info on the Betabrite Prism LED sign at <a target="_blank" href="http://www.betabrite.com">betabrite.com</a><br>
(In the US, we have found these available at Costco)<br>
<br>
1) Download and install Microsoft's .Net v1.1 and SP1<br>
2) Download: <a href="http://www.kitchi-rss.com">kitchi</a> and install<br>
3) Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">JoinAction-ledsign.zip</a> 
and extract to the C:\DNSREDIR working directory.<br>
4) Update your dnsredir.ini so...<br>
ActionNumber=1<br>
JoinAction=ledJoin.bat<br>
LeaveAction=ledLeave.bat<br>
5) Open kitchi and load the C:\DNSREDIR\ledsign.kcx file. 
In this sample the Output is pre-configured to display on a Betabrite Prism LED sign connected via USB, modify the Output for your particular sign. 
Click Start.<br>
6) Run DNS Redirector and have a client join, by default the following message will be displayed on the sign...<br>
Client with IP %1 joined the network at %time% on %date% so there are now %C% clients online!<br>
<br>
The process works like this: DNS Redirector kicks off the ledJoin.bat file, which writes a sentence to ledsign.txt<br>
Kitchi detects that the ledsign.txt file has changed (checking every 2 seconds) and then communicates the sentence in ledsign.txt to the sign<br>
ledcount.txt is used by the .bat files to keep track of how many clients are online, which is used in the %C% variable to display this number on the sign<br>
%1 is passed to the command-line by DNS Redirector, and contains the IP of the client who just joined or left<br>
<br>
To reset the LED sign, run ledReset.bat<br>
1) create a shortcut to ledReset.bat and add it to your Startup folder<br>
2) add ledReset.bat to the end of your updaterdone.bat<br>
...this way when the machine running DNS Redirector gets rebooted or keywords updated, 
the display of clients joining the network will start correctly from zero.<br>
<br>
NOTE: There is now a new way to do this, allowing you to keep a continual/looping message on the sign, 
and then interrupt with a message from DNS Redirector as the JoinAction or LeaveAction happens, see <a target="_blank" href="http://www.remote-control.net/documentation/kitchi/commandline.php">kitchi commandline option</a><br>

<br>
<br>
<br>

<a name="64"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 64: Further customize OpenDNS</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
OpenDNS allows some customization of their various blocked/guide pages, but what if you'd rather use your own page entirely?<br>
<br>
DNS Redirector allows you to customize your own blocked page with...<br>
- an email form (or other automated means) allowing end-users to inform/request the IT department unblock a site<br>
- instructions on who to contact for assistance<br>
- company logo<br>
- company Internet usage policy<br>
- messages like "restricted by company policy" or "Internet use monitored by..."<br>
- all white-space or "page cannot be found"<br>
- no 3rd party advertisements<br>
- 100% your own HTML served by your own web server<br>
<br>
If using <a href="full-FAQ.md#52">updater.exe</a> check the option "Include keywords aiding lack of NXDomain" to suppress the OpenDNS guide/block/adult/phish page. 
Any such site will result in your blocked page instead.<br>
<br>
Additionally, you could add the domains below to your blocked.txt file, or if using <a href="full-FAQ.md#52">updater.exe</a> to your blocked-custom.txt file.<br>
<br>
To suppress/change the page indicating that you're using OpenDNS:<br>
welcome.opendns.com<br>
<br>
To prevent OpenDNS applications, such as IP Updater:<br>
api.opendns.com<br>
debug.opendns.com<br>
myip.opendns.com<br>
opendnsupdate.appspot.com<br>
updates.opendns.com<br>
which.opendns.com<br>
(if you do this, determining which OpenDNS data center you are routed to, 
or using the OpenDNS Diagnostic application will not return reliable/true results, 
ensure you disable this before working with support personnel)<br>
<br>
To prevent access to any OpenDNS site, including forums and domain tagging:<br>
opendns.com<br>
(if you do this, an individual computer can get to the OpenDNS dashboard by using the bypass block method of your DNS Redirector blocked site, 
or from another network without the restrictions imposed by DNS Redirector)<br>
<br>
This works assuming OpenDNS is configured upstream as the real DNS server, as described in <a href="full-FAQ.md#40">FAQ 40</a>.<br>
<br>
Note: After 9 years OpenDNS <a target="_blank" href="http://blog.opendns.com/2014/05/29/no-more-ads/">has finaly conceded</a> that ads and security don't mix, 
as a result there is no guide page and you will get NXDOMAIN and SERVFAIL responses, therefore some information in this article is no longer applicable.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#40">FAQ 40</a> Use with OpenDNS<br>
<a href="full-FAQ.md#105">FAQ 105</a> Sites which do not exist are blocked<br>

<br>
<br>
<br>

<a name="65"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 65: Best practices for speedy DNS resolution</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
1) If the LAN has the potential for a large number of clients it is suggested that you run a "real" DNS server locally, 
so the response is always from a quick/local cache rather than an ISP/external server. 
You could use Microsoft's DNS service (included in Windows server) to do this. 
This service can co-exist on the same server running DNS Redirector, see <a href="full-FAQ.md#91">FAQ 91</a>. 
You then configure the "real" DNS server to forward queries out to your ISP's DNS servers.<br>
<br>
2) Use a fast and reliable "real" DNS server, your ISP's DNS servers may not always be the best choice. 
Use a benchmark tool <a href="https://drive.google.com/drive/folders/1JLL6UlbxI0sZy3610LfFa9Zk3g1tsDOY">as described here</a> to determine the fastest DNS servers from your connection.<br>
<br>
3) When looking at the DNS Redirector daily logs you may notice query timeouts, occasionally this is OK/expected. 
The upstream DNS server could be down, unavailable, overwhelmed, or just took too long. 
In some cases the DNS record doesn't exist; you'll often see these when someone comes to your network with their laptop from work, 
which might be an Active-Directory domain member. The work laptop tries to resolve internal domain/server names, but because it's not on the company 
network it's OK/normal that these don't resolve and timeout. 
Another case is reverse DNS lookups; (rdns, queries ending in .in-addr.arpa) which are often made by Macintosh/Apple clients for no discernible reason 
at all, it's OK/normal that these timeout and does not break any client functionality.<br>
<br>
4) Keep in mind DNS Redirector only manipulates DNS service. It's unlikely that DNS Redirector has an impact on the speed or throughput of the 
Internet connection; time to load a website after the initial resolve, time to download a file, or affect the use of voice/video over IP products, etc. 
It's more likely the free/public Internet access you're offering has become overly popular, or there are users who are abusing it with large downloads, 
thereby maxing out the throughput of the wireless access point, the firewall/router, and/or your ISP connection. 
You might try implementing additional blocked keywords to prevent certain high-bandwidth sites or services, or use a router with QoS or packet shaping capabilities. 
For a definitive answer run a bandwidth graphing program, software such as MRTG or <a target="_blank" href="http://www.paessler.com">PRTG</a> can be configured to monitor the perimeter firewall/router WAN 
port and plot a graph of utilization over time.<br>
<br>
5) If your blocked site is slow, not responding, or stuck in a redirect loop; this can cause some websites to load slower than expected. 
It is NOT a good idea to run the DNS Redirector blocked site on a workstation OS, use a server OS, due to IIS- OS Version Limits</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#126">FAQ 126</a> Best practices for public networks<br>

<br>
<br>
<br>

<a name="67"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 67: Internet down, so show everyone a message</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
An ISP customer asks, how can we redirect all our users to a page explaining the Internet is down and we're working on it? (so hopefully everybody won't call us)<br>
<br>
Method 1) Use this sample alert notice, Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">alertnotice.zip</a><br>
Basically, it pings something (default gateway, an upstream router, or upstream DNS server) and when it finds that IP isn't responding it copies in an alternate dnsredir.ini and restarts the .exe thereby resolving everything to a site you choose. 
See the readme included in the .zip to adapt it to your needs.<br>
<br>
Method 2) Use a software package such as <a target="_blank" href="http://www.solarwinds.com/products/ipmonitor">ipMonitor</a> or 
<a target="_blank" href="http://www.paessler.com">PRTG</a> to email/SMS you that there is a problem then copy in a new .ini and restart DNS Redirector so all users get redirected to a page explaining the Internet is down. 
This implementation needs to be done such that the server running the monitoring package can notify you AND/OR reach the DNS Redirector server to make the change. 
In some cases it may be necessary to run two monitoring packages, inside and outside of the network, in order to accomplish this.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#58">FAQ 58</a> Use during an emergency<br>

<br>
<br>
<br>

<a name="70"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 70: DNS Redirector software vs. SaaS or cloud offerings</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector software you install on your own servers, meaning uptime is the responsibility between your IT department and your ISP.<br>
<br>
Services like DNS Advantage, Norton DNS, and OpenDNS are SaaS (Software as a Service) or cloud services. 
This actually adds complexity and more points of failure. 
Uptime is the responsibility of not only your IT department and ISP, but thousands of Internet peers (routers/datacenters and the companies that manage them) and finally the service provider.<br>
<br>
DNS Redirector software offers some unique features the others don't...<br>
 - temporarily bypass the block on a per-client basis (sites resolve direct, no proxy problems)<br>
 - logging of sites visited/blocked with per-client detail<br>
 - fully customize/brand your welcome or blocked pages (100% your HTML, <a href="https://drive.google.com/drive/folders/1OReNRDrrkdnf8gjWTNRUZlYr3haM-w0i">samples provided</a>)<br>
 - block everything and allow just a few sites (<a href="full-FAQ.md#5">whitelist only</a>)<br>
 - block advertisements and other sources of spyware/malware<br>
 - display an emergency or network down message (<a href="https://drive.google.com/drive/folders/1KNDQZk0YMj6DSHv7fAJYGYBwAFhcyvd8/07.htm">no Internet</a>)<br>
<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#49">FAQ 49</a> What makes DNS Redirector different/better?<br>

<br>
<br>
<br>

<a name="71"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 71: Useful 3rd party links</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The following software is known to work with/aid in using DNS Redirector<br>
<br>
Alternative web server...<br>
- <a target="_blank" href="http://code.google.com/p/mongoose/">Mongoose</a><br>
- <a target="_blank" href="https://github.com/JPElectron/SimpleHTTP">SimpleHTTP</a><br>
<br>
Edit welcome/blocked pages...<br>
- <a target="_blank" href="http://www.adobe.com/products/dreamweaver.html">Adobe Dreamweaver</a><br>
- <a target="_blank" href="http://www.microsoft.com/expression/products/StudioWebPro_Overview.aspx">Microsoft Expression Studio 4 Web Professional</a><br>
- <a target="_blank" href="http://www.asp.net/vwd">Microsoft Visual Web Developer 2010 Express</a><br>
- <a target="_blank" href="http://www.microsoft.com/web/webmatrix">Microsoft WebMatrix</a><br>
- <a target="_blank" href="http://www.flos-freeware.ch/notepad2.html">Notepad2</a><br>
<br>
View log file in real-time...<br>
- <a target="_blank" href="http://www.baremetalsoft.com/baretail/">BareTail</a><br>
- <a target="_blank" href="http://www.kiwisyslog.com/kiwi-log-viewer-overview/">Kiwi Log Viewer</a><br>
- <a target="_blank" href="http://www.logfusion.ca">LogFusion</a><br>
<br>
Cleanup keyword lists...<br>
- <a target="_blank" href="http://www.abacre.com/afr/">Advanced Find & Replace</a><br>
- <a target="_blank" href="http://www.flos-freeware.ch/notepad2.html">Notepad2</a><br>
- <a target="_blank" href="http://www.regexbuddy.com">RegexBuddy</a><br>
<br>
Other keyword lists...<br>
- <a target="_blank" href="https://firebog.net">The Big Blocklist Collection</a> see <a href="full-FAQ.md#72">FAQ 72</a><br>
- <a target="_blank" href="https://blocklist.site">Block List Project</a> see <a href="full-FAQ.md#72">FAQ 72</a><br>
- <a target="_blank" href="https://github.com/StevenBlack/hosts">Unified hosts file</a> see <a href="full-FAQ.md#72">FAQ 72</a><br>
<br>
Review/statistics across multiple log files...<br>
- <a target="_blank" href="http://www.microsoft.com/download/en/details.aspx?id=24659">Microsoft Log Parser</a> see <a href="full-FAQ.md#111">FAQ 111</a><br>
- <a target="_blank" href="http://www.splunk.com">Splunk</a><br>
- See sample files in the Reporting folder<br>
<br>
Condense or email alert from log files...<br>
- See <a href="https://drive.google.com/drive/folders/1nCDTo7gJHeI7QKZG13NhnSE0Aoe3g48S">nxlog-ce sample files</a><br>
<br>
Monitor the DNS Redirector server...<br>
- <a target="_blank" href="http://www.paessler.com">PRTG</a> see <a href="full-FAQ.md#157">FAQ 157</a><br>
<br>
Additional network security...<br>
- IE URL Lock see <a href="full-FAQ.md#115">FAQ 115</a><br>
<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#72">FAQ 72</a> Using 3rd party keywords<br>

<br>
<br>
<br>

<a name="72"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 72: Using 3rd party keywords</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Several entries in 3rd party lists will be redundant and already included in the provided keyword lists.<br>
<br>
You can add more domains to your blocked.txt file, or if using <a href="full-FAQ.md#52">updater.exe</a> to your blocked-custom.txt file.<br>
<br>
Note that with HOSTS files each site must be individually specified as the fully-qualified-domain-name, this is inefficient and can miss blocking bad sub-domains.<br>
With DNS Redirector the full or partial <a href="full-FAQ.md#79">domain name</a>, a keyword, or a <a href="full-FAQ.md#106">regex</a> statement can be used.<br>
<br>
To make 3rd party files compatible with DNS Redirector...<br>

    no lines can have "127.0.0.1" or some other IP address
    no lines can have "localhost"
    no lines can have characters / \ | : ; ' " ` ~ ! ? @ # $ % ^ & * + = ( ) ...any of these suggest a URL
    no lines can have http:// https:// ftp:// mms:// ...use the domain name part only
    no lines can have .. (two periods or more, in series) not valid and won't get resolved by DNS
    
The <a href="full-FAQ.md#79">domain name</a> is the only part of the URL to get resolved by DNS.<br>
<br>
Which means "www.example.com" or ".example.com" or "example.com" are all acceptable keywords, with the last being the most thorough for blocking.<br>
<br>
When manually merging lists remember that one keyword must appear on each line, the file cannot contain any spaces, nor any blank lines 
(except for the last line).<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#71">FAQ 71</a> Useful 3rd party links<br>
<a href="full-FAQ.md#79">FAQ 79</a> What part of a URL is the domain name?<br>

<br>
<br>
<br>

<a name="75"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 75: Create 3 tiers of blocking</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Here's the scenario:<br>
1) Allow most users to browse only a handful of sites that you specify (whitelist only, or no websites at all)<br>
2) Allow some users* to browse more of the Internet (but not pornography, other categories, or sites that you specify)<br>
3) Allow administrators and/or executives to enter a password* and browse all of the Internet unrestricted<br>
<h4>Resolution</h4>
Set dnsredir.ini as follows...<br>
<br>
RedirectIP=192.168.0.3<br>
...this becomes the Blocked page for the 1st tier users (which will be shown for any site not defined in always.txt below)<br>
AuthKeywordsFile=authorized.txt<br>
...this is required for 1st tier users to bypass the restriction and become 2nd tier users<br>
AlwaysKeywordsFile=always.txt<br>
...this is used as the list of allowed websites that 1st tier users may visit, add any <a href="full-FAQ.md#79">domain name</a>s you want. 
See <a href="full-FAQ.md#5">FAQ 5</a> for other domains that you'll need to add here.<br>
<br>
BlockedIP=192.168.0.2<br>
...this becomes the Blocked page for the 2nd tier users<br>
BlockedKeywordsFile=blocked.txt<br>
...this is used as the list of blocked sites (use our keywords lists, or add any <a href="full-FAQ.md#79">domain name</a>s you want)<br>
BypassBlockFile=bypassblock.txt<br>
...this is required for 2nd tier users to bypass the restriction and become 3rd tier users<br>
<br>
* For a password login, use <a href="https://drive.google.com/drive/folders/1OReNRDrrkdnf8gjWTNRUZlYr3haM-w0i">blocked -suggested.zip</a> for each site in IIS 
(creating seperate sites at IP .0.3 and .0.2) see <a href="full-FAQ.md#76">FAQ 76</a>.<br>
For integrating with Active Directory credentials see <a href="full-FAQ.md#100">FAQ 100</a>.<br>
For setting the tier at logon see <a href="full-FAQ.md#77">FAQ 77</a>.<br>
For setting the workstation to tier 2 based on IP, set AuthClientsFile=authclients.txt in dnsredir.ini and add all the IPs that should be 2nd tier users to the authclients.txt file.<br>
<br>
It may be helpful to distinguish between the blocked pages for each tier, we suggest the site at .0.3 says "BLOCKED ALL" whereas 
the site at .0.2 says "BLOCKED"<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#5">FAQ 5</a> Block everything and allow just a few sites<br>

<br>
<br>
<br>

<a name="76"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 76: Using the suggested blocked site in IIS</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The sample <a href="https://drive.google.com/drive/folders/1OReNRDrrkdnf8gjWTNRUZlYr3haM-w0i">blocked -suggested.zip</a> automatically replaces blocked content with the correct type to avoid seeing broken images or flash objects.<br>
<br>
Configuration is done by editing \global.asa as instructed in the file.<br>
<br>
Modify \notice.asp to display a custom message or other information at the BLOCKED page.<br>
<br>
This blocked site allows users to click "O" in the word "BLOCKED" or visit http://[blocked-site]/login and enter a password to bypass 
the restriction. This is better than having the end-user type the unblocking domain (as specified in authorized.txt or 
bypassblock.txt) directly in the browser address bar; to avoid other's seeing it in the MRU drop down, autocomplete, or browser history.<br>
<br>
To upgrade an existing blocked site to the latest version follow either of the procedures below:<br>
<br>
1) Quick/easy method<br>
 - In many cases only the blocked.asp file will be different<br>
 - Check the following files for the version number<br>
&nbsp; (if any of your files doesn't have the version number, then you must do the full replacement procedure instead)<br>
&nbsp; The version is located within the first few lines of the file, and is similar to this format: = "14.37 r11/19/2011"<br>
&nbsp;&nbsp;&nbsp; blocked.asp<br>
&nbsp;&nbsp;&nbsp; email.asp<br>
&nbsp;&nbsp;&nbsp; footer.asp<br>
&nbsp;&nbsp;&nbsp; global.asa<br>
 - If one of your files has an older version number, then backup that file by renaming it [filename].old<br>
 - Extract the latest version of that same file to the root of your blocked site<br>
 - Inspect the old file and the new file for any settings/customization you may have done<br>
<br>
2) Full replacement<br>
 - Make a backup copy of the following files<br>
&nbsp;&nbsp;&nbsp; global.asa<br>
&nbsp;&nbsp;&nbsp; notice.asp (if you customized the display of the blocked page)<br>
&nbsp;&nbsp;&nbsp; blocked.asp (if you customized this file)<br>
&nbsp;&nbsp;&nbsp; email.asp (if you added the IP or hostname of your SMTP server)<br>
&nbsp;&nbsp;&nbsp; ...any graphics files (if you replaced graphics with your own)<br>
 - Extract the latest version of the suggested blocked site to the root of your blocked site, replacing all files<br>
 - Copy the values defined in your old global.asa to your new global.asa<br>
 - Inspect all the old files and the new files for any settings/customization you may have done<br>
 - Copy back your graphics files (if you replaced graphics with your own)<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#99">FAQ 99</a> Enable AdminWhitelist function of the Blocked site<br>
<a href="full-FAQ.md#100">FAQ 100</a> Enable BypassBlockADi function of the Blocked site<br>
<a href="full-FAQ.md#120">FAQ 120</a> Enable MakeRequest function of the Blocked site<br>

<br>
<br>
<br>

<a name="77"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 77: Logon script integration</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Using a logon script can allow some users to browse the Internet without the restrictions imposed by DNS Redirector.<br>
<br>
This is one way to toggle "authorization to surf" or "bypassing the block" when a user logs on.<br>
<h4>Resolution</h4>
The logon script is usually found in \\DC_server_name\NETLOGON\login.bat and specified under the user account Profile tab.<br>
<br>
Change the <a href="full-FAQ.md#79">domain name</a> pinged in the example below to match what you have specified in authorized.txt or bypassblock.txt<br>
<br>
 - - - - - START login.bat - - - - -<br>
@ECHO OFF<br>
NET USE H: \\server1\users$\%username%<br>
NET USE P: \\server1\public$<br>
<br>
if "%username%"=="mark" goto toggle<br>
if "%username%"=="Mark" goto toggle<br>
if "%username%"=="MARK" goto toggle<br>
EXIT<br>
<br>
:toggle<br>
ping secret.example.com -n 1<br>
CLS<br>
EXIT<br>
 - - - - - END login.bat - - - - -<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#92">FAQ 92</a> Set different DNS servers via Group Policy<br>
<a href="full-FAQ.md#164">FAQ 164</a> Set different DNS servers via DHCP MAC filtering<br>

<br>
<br>
<br>

<a name="79"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 79: What part of a URL is the domain name?</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Only domain names are matched in keyword lists in DNS Redirector.<br>
<br>
As an example, these are all URLs...<br>
<br>
&nbsp;&nbsp;&nbsp;http://www.example.com/folder/page.htm<br>
&nbsp;&nbsp;&nbsp;http://www.example.com:8080/folder/page.htm<br>
&nbsp;&nbsp;&nbsp;&nbsp;ftp://www.example.com/folder/file.exe<br>
&nbsp;mms://www.example.com/folder/media.wmv<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;www.example.com&nbsp;&nbsp;&nbsp;...is the domain name<br>
<br>
The domain name will always start at the begining of a URL, right after the second / and end before the third /<br>
<br>
These characters&nbsp;&nbsp;/ \ | : ; ' " ` ~ ! ? @ # $ % ^ & * + = ( )&nbsp;&nbsp;&nbsp;...cannot be in any domain name<br>
These protocols&nbsp;&nbsp;http://&nbsp;&nbsp;https://&nbsp;&nbsp;ftp://&nbsp;&nbsp;mms://&nbsp;&nbsp;&nbsp;...are not part of the domain name*<br>
A port declaration&nbsp;&nbsp;:3128&nbsp;&nbsp;:8080&nbsp;&nbsp;&nbsp;...is not part of the domain name*<br>
Records with .. (two periods or more in series) are invalid and won't get resolved by DNS<br>
HTTP Header or Content-Types are not resolved by DNS<br>
<br>
The domain name is the only part of the URL to get resolved by DNS, and therefore the only part matched by keyword lists in DNS Redirector.<br>
*use firewall rules to block whole protocols, ports, and content-types; none of these are a function of DNS.<br>
<br>
Which means the plain keywords:&nbsp; www.example.com&nbsp; -or-&nbsp; .example.com&nbsp; -or-&nbsp; example.com &nbsp;-or-&nbsp; example&nbsp; ...are all acceptable.<br>
However, a regex statement might be a better choice: ^(.*\.)?example\.com$<br>
DNS Redirector lists accept plain keywords and regex statements only.<br>
<br>
When copy/pasting/merging lists remember that one keyword must appear on each line, the file cannot contain any spaces, nor any blank lines 
(except for the last line).<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#72">FAQ 72</a> Using 3rd party keywords<br>
<a href="full-FAQ.md#106">FAQ 106</a> Use regular expressions in BlockedKeywordsFile<br>
<a href="full-FAQ.md#112">FAQ 112</a> Use regular expressions in AllowedKeywordsFile<br>

<br>
<br>
<br>

<a name="86"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 86: I found something really bad that wasn't blocked!</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
No filter is perfect! Add the offending domain name to your custom block list.<br>
<br>
DNS based blocking is only part of the battle against viruses, badware, and user mischief. 
Virus protection and a hardware firewall with strict rules should also be used to mitigate problems.<br>
<br>
Consider using DNS Redirector to block all other <a target="_blank" href="http://en.wikipedia.org/wiki/Country_code_top-level_domain">ccTLD</a>'s 
and <a target="_blank" href="http://en.wikipedia.org/wiki/Geographic_TLD">GeoTLD</a>'s that are not relevant to your business, 
see <a href="full-FAQ.md#106">FAQ 106</a>.<br>
<br>
An even better way to ensure network security and prevent problems is to <a href="full-FAQ.md#5">block everything</a> and whitelist 
only the few sites/DNS entries needed for business purposes.<br>
<br>
Similarly, generic blocking keywords may adversely block legitimate sites, this is known as the <a target="_blank" href="http://en.wikipedia.org/wiki/Scunthorpe_problem">Scunthorpe problem</a>. 
Administrators can whitelist any domain using AllowedKeywordsFile=<br>

<br>
<br>
<br>

<a name="89"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 89: Use to enforce mobile users corporate security</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You can use DNS Redirector to ensure company laptops always use their VPN when at home or away from the office.  This way, the corporate VPN policy for Internet use and email is always enforced on the laptop.  Basically ensuring the laptop is only used for business purposes.<br>
<br>
Install DNS Redirector on the company-owned laptop and follow the instructions to configure all network adapters (except the VPN adapter) with 127.0.0.1 for the DNS server.<br>
<br>
Create a blocked.txt file and put just a . (period) in it on the first line, this blocks everything.<br>
<br>
Create an allowed.txt so your internal domain name(s) and VPN endpoint hostname are accessible, for example:<br>
^.*\.hq\.contoso\.com$<br>
^vpn\.contoso\.com$<br>
^contoso\.com$<br>
^www\.contoso\.com$<br>
<br>
Both of these files should be in the DNS Redirector working directory (usually C:\DNSREDIR) and specified in dnsredir.ini as:<br>
BlockedKeywordsFile=blocked.txt<br>
AllowedKeywordsFile=allowed.txt<br>
<br>
Set DNS Redirector to run as a service.<br>

<br>
<br>
<br>

<a name="90"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 90: Log only authorizations</h3><font size=1>Category: Action functions</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Create a log of clients who successfully authorize. Useful for a quick count or to see how popular your hotspot is.<br>
<h4>Resolution</h4>
Update your dnsredir.ini so...<br>
<br>
ActionNumber=1<br>
JoinType=Auth<br>
JoinAction=authlog.bat<br>
<br>
Create authlog.bat in the DNS Redirector working directory...<br>
<br>
- - - - - START authlog.bat - - - - -<br>
@ECHO OFF<br>
ECHO Client with IP %1 joined the network at %time% on %date% >> authlog.txt<br>
EXIT<br>
- - - - - END authlog.bat - - - - -<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#62">FAQ 62</a> Get the IP or MAC of the client who just joined<br>

<br>
<br>
<br>

<a name="91"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 91: Set Microsoft DNS service to a single IP</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
When running DNS Redirector on the same server that is your internal DNS server, such as your Active Directory (AD) Domain Controller (DC), you must set each service to listen on a separate IP.<br>
<h4>Resolution</h4>
Add a second IP address (to the same NIC) under TCP/IP properties > Advanced button<br>
<br>
Set this new IP for ListenOnIP= in dnsredir.ini<br>
<br>
Open Control Panel > Administrative Tools > DNS<br>
<br>
Right-click on the server name and select Properties<br>
<br>
Under the Interfaces tab...<br>
Listen on: Only the following IP addresses:<br>
In Windows 2003 and below, ensure only the original server IP appears in the list box (as <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">shown in DNS2003-InterfacesTab.gif</a>)<br>
In Windows 2008 and above, ensure only the original server IP appears checked (as <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">shown in DNS2008-InterfacesTab.gif</a>)<br>
<br>
Under the Forwarders tab...<br>
Verify your ISP's DNS server(s) are specified here, optionally use <a target="_blank" href="http://code.google.com/speed/public-dns/">Google DNS</a><br>
<br>
Close all dialog boxes/management consoles and then restart the DNS Server service (in some cases you may need to restart the server)<br>
This prevents the Microsoft DNS service from using the new IP address.<br>
<br>
Ensure your DHCP scope hands out <u>only</u> the new DNS Redirector ListenOnIP= to client computers.<br>
DNS resolution is: Client > DNS Redirector > Microsoft DNS service > forward to ISP<br>
<br>
Servers should continue to use the original IP of the Microsoft DNS service.<br>
DNS resolution is: Server > Microsoft DNS service > forward to ISP<br>

<br>
<br>
<br>

<a name="92"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 92: Set different DNS servers via Group Policy</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Using a Group Policy in Active Directory (AD) can allow some users to browse the Internet without the restrictions imposed by DNS Redirector.<br>
<br>
This is one way to assign different DNS servers to different users.<br>
<h4>Resolution</h4>
See <a target="_blank" href="http://support.microsoft.com/kb/294785">kb294785</a>, DNS Servers section.<br>
<br>
Under DNS Servers click Enable, then type the IP address of your internal Active Directory (AD) Domain Controller (DC) DNS server.<br>
<br>
Users who you decide get this Group Policy applied will use the internal DNS service and not the DNS Redirector service 
(as normally provided to everyone via DHCP), therefore these users won't be filtered.<br>
<br>
You could also use this method to assign different DNS Redirector instances to different user groups, thereby creating different filtering policies.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#77">FAQ 77</a> Logon script integration<br>
<a href="full-FAQ.md#164">FAQ 164</a> Set different DNS servers via DHCP MAC filtering<br>

<br>
<br>
<br>

<a name="97"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 97: Query the number of clients online via DNS</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
From any machine that is a client of DNS Redirector (has the ListenOnIP= set as it's sole DNS server) 
you can use the command nslookup to determine how many clients are online...<br>
<br>
online.dnsr.local - returns the current number of clients found<br>
authonline.dnsr.local - returns the current number of authorized clients<br>
<br>
Realize this is only a method to report a number back, not an actual IP address, for example...<br>
<br>
C:\WINDOWS\system32>nslookup online.dnsr.local<br>
Server:  UnKnown<br>
Address:  192.168.4.8<br>
<br>
Non-authoritative answer:<br>
Name:    online.dnsr.local<br>
Address:  0.0.0.3<br>
<br>
...than 3 clients are online<br>
<br>
Address:  0.2.2.8<br>
<br>
...than 228 clients are online<br>
<br>
While the command-line "ping online.dnsr.local" will achieve the same result, 
this should not be relied upon because Windows may cache the result just like any normal DNS lookup 
(unless the command-line "ipconfig /flushdns" is run prior, the number of clients online reported via ping may be stale)<br>
<br>
Note in some environments it may be necessary to perform this DNS lookup with a trailing period, for example:<br>
nslookup online.dnsr.local.<br>
nslookup authonline.dnsr.local.<br>
<br>
Run _checkdns_.bat (found in the Reporting folder) to display these statistics<br>
<br>
Other DNS lookups for diagnostic purposes...<br>
<br>
whoami.akamai.net - when querying against a anycast system (for example when Google DNS of 8.8.8.8 or 8.8.4.4 is an upstream resolver) 
this will show the unicast address of the anycast node which forwarded the request to Akamai. 
The IP address in the answer is that of Google's individual server (which is, ideally, your shortest/fastest route based on location) that is handling your DNS traffic.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#157">FAQ 157</a> Monitor your DNS Redirector server with PRTG<br>

<br>
<br>
<br>

<a name="99"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 99: Enable AdminWhitelist function of the Blocked site</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In IIS, the site for the blocked page must use a unique Application Pool with the Identity configured as "Local System"<br>
<br>
The code assumes AllowedKeywordsFile=allowed.txt in dnsredir.ini and C:\DNSREDIR is the working directory.<br>
If that is not the case, modify \allow.asp where you see "C:\DNSREDIR\allowed.txt" to be the path of your file.<br>
<br>
IUSR[_SERVERNAME] and IIS_IUSRS must be given NTFS "Modify" permissions to C:\DNSREDIR<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#76">FAQ 76</a> Using the suggested blocked site in IIS<br>

<br>
<br>
<br>

<a name="100"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 100: Enable BypassBlockADi function of the Blocked site</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
This allows users to click "O" in the word "BLOCKED" or visit http://[blocked-site]/login and enter their Active Directory (AD) credentials to bypass the block.<br>
<br>
In IIS, under the blocked site, deny anonymous access from the /login/secure directory.<br>
<br>
In Explorer, add NTFS "Read" permissions to the \login\secure directory with the user(s) or group(s) allowed to bypass the block.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#76">FAQ 76</a> Using the suggested blocked site in IIS<br>

<br>
<br>
<br>

<a name="101"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 101: Client is instantly authorized, but that is not my intention</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Every client who joins the network is immediately marked as authorized.<br>
<h4>Cause</h4>
The file specified for AuthKeywordsFile= contains blank lines or spaces between keywords.<br>
<br>
If you are not using redirection (RedirectIP= and AuthKeywordsFile= are not defined) then it is normal that all clients are immediately authorized.<br>
<h4>Resolution</h4>
Check that your authorized.txt file contains keywords on every line, or otherwise a comment (line starting with the ; character) 
If there are any blank lines or spaces in the file, including any trailing at the end, you will experience this behavior.<br>
<br>
Add only domain names to this list, see <a href="full-FAQ.md#79">FAQ 79</a> for help identifying domain names.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#6">FAQ 6</a> Everything is blocked, but that is not my intention<br>
<a href="full-FAQ.md#51">FAQ 51</a> Everything is allowed, but that is not my intention<br>

<br>
<br>
<br>

<a name="102"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 102: Allow DNS Redirector through any firewalls</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
If a software firewall is enabled on the machine running DNS Redirector some exclusions must be made.<br>
Examples: Windows Firewall, ZoneAlarm, Panda Global Protection (or other virus scan/security suite products that include port blocking)<br>
<br>
If a hardware firewall is used some TCP/UDP ports must be allowed through.<br>
<h4>Resolution</h4>
If Windows firewall is used the exceptions can be added automatically, 
right-click on fixFirewall.bat and select "Run as administrator"<br>
<br>
When manually configuring a software firewall add exceptions for the program executables:<br>
<br>
Allow C:\DNSREDIR\dnsrsvc.exe<br>
Allow C:\DNSREDIR\updater.exe (if using <a href="full-FAQ.md#52">Updater</a>)<br>
<br>
If IIS is also installed on this server, you may need to add a port-based exception such as:<br>
<br>
Allow TCP port 80 for "IIS"<br>
<br>
If a hardware firewall is used ensure the following ports are open:<br>
<br>
UDP 53 between the DNS Redirector server and the upstream DNS server (usually your ISP's server on the Internet)<br>
UDP 53 between client computers and the DNS Redirector server<br>
TCP 80 between client computers and the IIS server (usually the same as the DNS Redirector server)<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#39">FAQ 39</a> Prevent the DNS Redirector server from attack<br>

<br>
<br>
<br>

<a name="103"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 103: Upgrade to DNS Redirector v7</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7.2.0.18 <a href="https://github.com/JPElectron/DNSRedirOSS">is the latest</a>!<br>
<br>
When upgrading your <u>version</u> 7.2.0.6 or later to the latest version...<br>
1) Stop the DNS Redirector service<br>
2) Download the software from <a href="https://github.com/JPElectron/DNSRedirOSS/raw/main/dnsredir-download.zip">dnsredir-download.zip</a><br>
3) Right-click on the .zip you downloaded, select Properties, click the Unblock button or checkbox (if this is not present just proceed), click OK<br>
4) Copy dnsrsvc.exe, dnsrlib.dll to the working directory C:\DNSREDIR<br>
5) Start the DNS Redirector service<br>
<br>
When upgrading your <u>very old version</u> 6.x or 7.x to the latest version...<br>
Note: New and/or different INI settings have been added, see the <a href="full-ReadMe.md">readme</a>.<br>
1) Stop the DNS Redirector service<br>
2) Remove the old service from the command-line with...<br>
&nbsp;&nbsp;&nbsp; sc delete "DNS Redirector"<br>
&nbsp;&nbsp;&nbsp; sc delete dnsredir<br>
3) Rename your existing dnsredir.ini to dnsredir-saveold.ini, and rename your updater.ini to updater-saveold.ini<br>
4) Install <a href="full-FAQ.md#108">.NET Framework</a> (and restart)<br>
5) Download the software from <a href="https://github.com/JPElectron/DNSRedirOSS/raw/main/dnsredir-download.zip">dnsredir-download.zip</a><br>
6) Right-click on the .zip you downloaded, select Properties, click the Unblock button or checkbox (if this is not present just proceed), click OK<br>
7) Extract all the files from the .zip to the working directory C:\DNSREDIR<br>
8) Copy/paste the individual values (NOT the whole line) from dnsredir-saveold.ini to the new dnsredir.ini<br>
&nbsp;&nbsp;&nbsp; ! Verify the working directory permissions, see <a href="full-FAQ.md#129">FAQ 129</a>.<br>

<br>
<br>
<br>

<a name="105"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 105: Sites which do not exist are blocked</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Sites which do not exist (or entered as a typo) are blocked.<br>
<h4>Cause</h4>
A) BlockResponse=Fast in dnsredir.ini<br>
<br>
B) The DNS server specified for DNSServerIP= in dnsredir.ini is redirecting all NXDOMAINs to a site 
(usually some search/suggestion/guide page) that is blocked by one or more of your blocking keywords. 
Some ISPs do this, some other free DNS services do this, and <a target="_blank" href="http://blog.opendns.com/2014/05/29/no-more-ads/">OpenDNS used to</a> do it.<br>
<h4>Resolution</h4>
A) Set BlockResponse=Lookup in dnsredir.ini (then restart DNS Redirector so changes become active)<br>
<br>
B1) Add the domain name of the search/suggestion/guide page to your AllowedKeywordsFile=allowed.txt file<br>
<br>
B2) Opt-out of your ISP's "helpfull" DNS response (process varies by ISP, some do not allow opt-out)<br>
<br>
B3) Use another DNS server instead of the free service<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#40">FAQ 40</a> Use with OpenDNS<br>
<a href="full-FAQ.md#64">FAQ 64</a> Further customize OpenDNS<br>

<br>
<br>
<br>

<a name="106"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 106: Use regular expressions in BlockedKeywordsFile</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7 allows for regular expressions (also referred to as regex or regexp) in any keyword list.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; that's at least 1 line not starting with ^<br>
<br>
A helpful site for understanding regex is: <a target="_blank" href="http://www.regular-expressions.info/reference.html">www.regular-expressions.info</a><br>
<h4>Examples</h4>
&nbsp;&nbsp; Using the regex...<br>
^adimg\d<br>
&nbsp;&nbsp; would block domains like...<br>
adimg1.example.com<br>
adimg2.example.com<br>
adimg3.example.com<br>
&nbsp;&nbsp; which is more efficient than using plain keywords for each ad server you wish to block.<br>
<br>
&nbsp;&nbsp; Using the regex...<br>
^.*\.cn$<br>
&nbsp;&nbsp; would block any domains ending in China's county code: .cn<br>
&nbsp;&nbsp; which is more efficient then using plain keywords for each .cn site you wish to block.<br>
<h4>Recommendation</h4>
You can greatly improve network security by using regex statements in DNS Redirector to block the following...<br>
<br>
- <a target="_blank" href="https://www.google.com/search?q=vanity+tld+problem">Vanity TLD</a>'s since there's lots of fraud in this namespace<br>
A list of all TLDs can be found here: <a target="_blank" href="http://data.iana.org/TLD">IANA</a> or here: <a target="_blank" href="https://bgp.he.net/report/dns#_alltlds">Hurricane Electric</a>.<br>
Additional explanation <a target="_blank" href="http://www.iana.org/domains/root/db">found here</a>, or see the <a target="_blank" href="https://ntldstats.com/tld">new TLD statistics</a>.<br>
Also statistics on fraud <a target="_blank" href="https://www.symantec.com/connect/blogs/shady-tld-research-mom-and-our-q1-wrap">here</a> and <a target="_blank" href="https://ntldstats.com/fraud">here</a>.<br>
<br>
- <a target="_blank" href="http://en.wikipedia.org/wiki/Internationalized_domain_name">IDN</a>'s that are not relevant to your business<br>
For example:&nbsp; ^(.*\.)?xn--.* &nbsp;(to block all)<br>
Also note:&nbsp; ^.*\.bycc2ii\.net$ &nbsp;(for Thailand, but this is not an ICANN-sanctioned IDN encoding method)<br>
<br>
- <a target="_blank" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains#Internationalized_country_code_top-level_domains">IDN ccTLD or ccIDN</a>'s that are not relevant to your business<br>
For example:&nbsp; ^.*\.xn--fiqs8s$ &nbsp;and:&nbsp; ^.*\.xn--fiqz9s$ &nbsp;(for China)<br>
Or use:&nbsp; ^.*\.xn--.*$ &nbsp;(to block all)<br>
<br>
- <a target="_blank" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains#Geographic_top-level_domains">GeoTLD</a>'s that are not relevant to your business<br>
<br>
- <a target="_blank" href="http://en.wikipedia.org/wiki/List_of_Internet_top-level_domains#Country_code_top-level_domains">ccTLD</a>'s that are not relevant to your business<br>
Note: Remove or comment out (by placing ; at the start of a line) your own country code and any others you want accessible.<br>
<br>
- There are <a target="_blank" href="http://oxforddictionaries.com/words/are-there-any-english-words-containing-the-same-letter-three-times-in-a-row">no English words with triple letters</a> 
and domains aiding or embedding badware sometimes contain 3 concurrent letters<br>
Note: 3 letters may adversely block some <a target="_blank" href="http://en.wikipedia.org/wiki/Acronym_and_initialism">acronyms</a>, but you can always whitelist any domains you do want to visit, or consider 4 letters<br>
Note: Exclude "www" because many websites still start with www. or "xxx" because this is already in the porn keywords list.<br>
<br>
&nbsp;<b>[</b> See a sample blocked file here: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">example-blocked-custom.txt</a> <b>]</b><br>
...the contents can be pasted into your blocked.txt file, or if using <a href="full-FAQ.md#52">updater.exe</a> to your blocked-custom.txt file.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#112">FAQ 112</a> Use regular expressions in AllowedKeywordsFile<br>
<a href="full-FAQ.md#114">FAQ 114</a> Advert block list does not include some ccTLD's<br>

<br>
<br>
<br>

<a name="107"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 107: Problems with certain firewalls</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
 - Clients separated from the DNS Redirector server by a firewall are either;<br>
&nbsp; not able to resolve any DNS, or<br>
&nbsp; not able to resolve modified DNS queries (such as those returned by SimpleDNS=, RedirectIP=, or BlockedIP= functions)<br>
<br>
 - Some websites fail to resolve via DNS, the result being the website is inaccessible.<br>
<br>
 - DNSSEC or CNAME records fail to resolve, this may be apparent only if the client traverses a L2L VPN tunnel to reach the DNS Redirector server.<br>
<h4>Cause</h4>
DNS traffic inspection is being performed by the firewall.<br>
Older firewalls/device firmware may regard DNS replies over 512 bytes as suspect, this prevents passing DNSSEC records which can legitimately be more than 512 bytes.<br>
<br>
<u>On a Cisco PIX or ASA firewall the relevant configuration lines are...</u><br>
policy-map type inspect dns preset_dns_map<br>
&nbsp;&nbsp;parameters<br>
&nbsp;&nbsp;&nbsp;&nbsp;message-length maximum 512 <b>&nbsp;&nbsp; ...Problem</b><br>
policy-map global_policy<br>
&nbsp;&nbsp;class inspection_default<br>
&nbsp;&nbsp;&nbsp;&nbsp;inspect dns preset_dns_map <b>&nbsp;&nbsp; ...DNS inspection enabled</b><br>
<h4>Resolution</h4>
Depending on your firewall; either upgrade the software/firmware to support DNSSEC, modify the configuration to allow DNSSEC, or disable DNS traffic inspection.<br>
<br>
For Cisco PIX or ASA firewall products see: <a target="_blank" href="http://www.cisco.com/web/about/security/intelligence/dnssec.html#11">Preparing for DNSSEC</a><br>
To test/prove this is the issue, you can remove DNS traffic inspection entirely with these commands:<br>
policy-map global_policy<br>
class inspection_default<br>
no inspect dns<br>
write mem<br>
<br>
If your DNS Redirector server forwards DNS to an Active Directory (AD) Domain Controller (DC) DNS server, 
the symptoms described here may be related to the Windows Server DNS service, see: <a target="_blank" href="http://support.microsoft.com/kb/832223">kb832223</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#110">FAQ 110</a> Problems with certain routers<br>

<br>
<br>
<br>

<a name="108"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 108: Microsoft .NET Framework is required</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7.2.0.18 <a href="https://github.com/JPElectron/DNSRedirOSS">is the latest</a>! ... and the Microsoft .NET Framework 4.6.1 is required, however you can/should use any later .NET Framework version.<br>
<h4>Resolution</h4>
1) Download and install <a target="_blank" href="https://www.microsoft.com/net/download/dotnet-framework-runtime">Microsoft .NET Framework</a> 4.6.1 or later<br>
<br>
2) Restart your server (really, do restart even if the installer did not prompt you)<br>
<br>
3) Download and install DNS Redirector<br>
<br>
<br>
<i>Note: If you have .NET Framework 4.8 / 4.7.2 / 4.7.1 / 4.7 / 4.6.2 these versions supersede 4.6.1 so you DO NOT need to install 4.6.1 specifically<br>
If needed, the steps to install 4.6.1 on an older OS are provided below...</i><br>
<br>
1) On a fresh install of Server 2008 R2, <a target="_blank" href="http://www.microsoft.com/en-us/download/details.aspx?id=5842">Service Pack 1</a> is required<br>
or<br>
1) On a fresh install of Server 2012 R2 the following are nessesary before .NET Framework 4.6.1 will install...<br>
&nbsp;&nbsp;&nbsp;&nbsp;1st) <a target="_blank" href="https://support.microsoft.com/en-us/kb/2919442">KB2919442</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;2nd) <a target="_blank" href="https://support.microsoft.com/en-us/kb/2919355">KB2919355</a>, 
which is several updates that must be done in the following order...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.a) clearcompressionflag.exe<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.b) KB2919355<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.c) KB2932046<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.d) KB2959977<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.e) KB2937592<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.f) KB2938439<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.g) KB2934018<br>
&nbsp;&nbsp;&nbsp;&nbsp;3rd) <a target="_blank" href="https://support.microsoft.com/en-us/kb/3102812">KB3102812</a>, 
this fixes the Windows Update hangup issue, which you'll appreciate later when it's time to get updates for this server.<br>
<br>
2) Download and install <a target="_blank" href="http://www.microsoft.com/en-us/download/details.aspx?id=49982">Microsoft .NET Framework 4.6.1</a>, if the progress bar appears to stall, wait it out, it will complete!<br>
<br>
3) Restart your server (really, do restart even if the installer did not prompt you)<br>
<br>
4) Wait for <a href="full-FAQ.md#168">.NET optimization</a> to finish<br>
<br>
5) Download and install DNS Redirector<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#168">FAQ 168</a> Microsoft .NET optimization high CPU<br>

<br>
<br>
<br>

<a name="110"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 110: Problems with certain routers</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Some D-Link, Linksys, Netgear, and other <a href="full-FAQ.md#35">consumer or home-grade devices</a> have an option called DNS Relay or DNS Proxy and this option must be disabled 
when a DNS server is inside the LAN.<br>
<br>
Alternative firmware <a target="_blank" href="http://www.polarcloud.com/tomato">Tomato</a> or 
<a target="_blank" href="http://www.dd-wrt.com">DD-WRT</a> calls this DNS Masquerading and this option must be disabled.<br>
<h4>Cause</h4>
When DNS Relay / DNS Proxy / dnsmasq / DNS Masquerading / DNS Forwarding is enabled the device captures all outgoing DNS traffic and directs it to the DNS server specified. 
Since the DNS server specified is inside the LAN (the IP of the DNS Redirector server) DNS resolution is basically stuck in a loop and 
cannot resolve out to the Internet.<br>
<br>
Some routers are very lousy when acting as a DNS forwarder, leading to unresolved queries which results in retries which gives the impression Internet is slow or un-responsive. 
Our suggestion for performance and simplicity is to never allow your firewall/router to act as a DNS forwarder.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#35">FAQ 35</a> Known incompatible devices<br>
<a href="full-FAQ.md#107">FAQ 107</a> Problems with certain firewalls<br>

<br>
<br>
<br>

<a name="111"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 111: Using Log Parser with DNS Redirector</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
<a target="_blank" href="http://www.microsoft.com/download/en/details.aspx?id=24659">Microsoft Log Parser</a> 
can be used to analyze the daily log files produced by DNS Redirector.<br>
<br>
_runreport_.bat (found in the Reporting folder) provides an easy menu that facilitates running these commands...<br>
<br>
For example, you might want to find:<br>
<br>
...anything that was blocked...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%BlockedIP response sent%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
...blocked domains that reference microsoft...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%BlockedIP response sent%%microsoft%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
...everywhere that the client with IP 192.168.20.102 got blocked...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%192.168.20.102 [DNSRedir] BlockedIP response sent%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
...sites that were accessed via allowed keywords...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%AllowedKeyword bypass%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
...clients who bypassed the block...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%BypassBlock toggled%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
...clients who are accessing myspace...<br>
LOGPARSER "Select Text from 'C:\DNSREDIR\DailyLogs\*16.txt' where Text like '%myspace.com%'" -i:TEXTLINE -o:DATAGRID<br>
<br>
Note: In the statements above 'C:\DNSREDIR\DailyLogs\*16.txt' restricts the search to the year 2016<br>

<br>
<br>
<br>

<a name="112"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 112: Use regular expressions in AllowedKeywordsFile</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7 allows for regular expressions (also referred to as regex or regexp) in any keyword list.<br>
<br>
All keyword lists need to have at least one non-regex keyword present; that's at least 1 line not starting with ^<br>
<br>
A helpful site for understanding regex is: <a target="_blank" href="http://www.regular-expressions.info/reference.html">www.regular-expressions.info</a><br>
<h4>Examples</h4>
&nbsp;&nbsp; A plain keyword such as...<br>
malwarebytes.org<br>
&nbsp;&nbsp; is too generic because it would allow all of these domains...<br>
malwarebytes.org<br>
www.malwarebytes.org<br>
fakemalwarebytes.org *<br>
malwarebytes.orgfakesite.com *<br>
malwarebytes.org.otherfakesite.com *<br>
&nbsp;&nbsp; * = these last 3 are bad and not the legitimate site!<br>
<h4>Recommendation</h4>
&nbsp;&nbsp; A better regex keyword is...<br>
^malwarebytes\.org$<br>
&nbsp;&nbsp; this allows clients to visit: http://malwarebytes.org<br>
&nbsp;&nbsp; but you would also need regex keyword...<br>
^.*\.malwarebytes\.org$<br>
&nbsp;&nbsp; this allows clients to visit: http://www.malwarebytes.org<br>
&nbsp;&nbsp; and perform software updates from: http://mbam-cdn.malwarebytes.org<br>
&nbsp;&nbsp; These two regex statements can be combined with a single regex...<br>
^(.*\.)?malwarebytes\.org$<br>
&nbsp;&nbsp; and assuming you trust any sub-domain of "malwarebytes.org" which is probably safe, then this is OK,<br>
&nbsp;&nbsp; however it is possible an attacker could make a subdomain for negarious purposes,<br>
&nbsp;&nbsp; so explicitly defining all the known subdomains you need is most secure...<br>
^(www\.|mbam-cdn\.)?malwarebytes\.org$<br>
<br>
&nbsp;&nbsp; To recap, the following are all valid...<br>
^example\.com$<br>
^.*\.example\.com$<br>
^hostname\.example\.com$<br>
&nbsp;&nbsp; The following regex consolidates all three...<br>
^(.*\.)?example\.com$<br>
&nbsp;&nbsp; The following is most secure...<br>
^(www\.|hostname\.)?example\.com$<br>
<br>
Using a well constructed regex prevents false sites that contain the same domain from being accessible.<br>
<br>
Since popular services and websites may use many domains or rely on 3rd party <a target="_blank" href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a> domains, 
incorporating an allowed list can avoid disruption to services your company relies on.<br>
Remember that your internal domain suffix should also be included in your allowed file.<br>
<br>
&nbsp;<b>[</b> See a sample allowed file here: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">example-allowed.txt</a> <b>]</b><br>
...the contents can be pasted into your allowed.txt file.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#159">FAQ 159</a> Useful AllowedKeywordsFile or AlwaysKeywordsFile additions<br>
<a href="full-FAQ.md#106">FAQ 106</a> Use regular expressions in BlockedKeywordsFile<br>

<br>
<br>
<br>

<a name="113"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 113: AP configuration in public wireless networks</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
To prevent wireless users from 'hacking' into other machines on the same access point you should enable 'AP Isolation'<br>
<br>
Also known as...<br>
- Public Secure Packet Forwarding (PSPF) found under VLAN settings on Cisco devices<br>
- Station Separation found under SSID Profile on EnGenius devices<br>
<br>
This also has the benefit of improving wireless network performance because the Access Point radio no longer sends traffic between associated devices.<br>
<br>
This setting prevents one wireless device from directly communicating with another on the same AP, 
thus eliminating the problem of malicious users accessing open Windows shares or unsecured PCs. 
However, this setting can also break multi-player gaming or other applications that require a direct connection over the LAN.<br>
<br>
Even with this setting enabled, wireless devices would be allowed to communicate out the wired interface of their AP 
to another wireless device that is associated to a different AP. 
Advanced protection against device to device communication across different APs should be achieved using VLANs or ACLs within your network infrastructure.<br>

<br>
<br>
<br>

<a name="114"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 114: Advert block list does not include some ccTLD's</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The list: <u>Advertisements / spyware / badware</u><br>
<br>
<b>+ included</b> are numerous 3rd party ad servers, many of which lead to spyware / badware<br>
<b>+ included</b> are all known bad domains except those ending with the below country-codes<br>
<br>
<b>- not</b> included are domains ending in the following ccTLD's<br>
^.*\.cc$<br>
^.*\.ch$<br>
^.*\.cn$<br>
^.*\.cz$<br>
^.*\.in$<br>
^.*\.nl$<br>
^.*\.pl$<br>
^.*\.ru$<br>
^.*\.su$<br>
^.*\.tk$<br>
^.*\.tw$<br>
Note: Domains ending with these ccTLD's are constantly being registered and used to distribute spyware/badware. 
Therefore, you should block all domains ending with these ccTLD's (and any/all other countries your organization doesn't conduct business in) per <a href="full-FAQ.md#106">FAQ 106</a>. 
This is most secure, but may require you to whitelist more sites that you actually use.<br>
<br>
...compare that to...<br>
<br>
The list: <u>All confirmed spyware / badware</u><br>
<br>
<b>+ included</b> are only confirmed bad domains, at any TLD (includes all ccTLD's)<br>
<br>
<b>- not</b> included are domains of legitimate 3rd party ad servers<br>
<br>
...so in other words...<br>
<br>
Most effective for network security is to check the 1st list, and implement a ccTLD block per <a href="full-FAQ.md#106">FAQ 106</a><br>
Alternatively, you can check both lists to block ads and bad domains at any TLD (without having to also implement a ccTLD block)<br>
Or, check only the 2nd list to block domains actively distributing adware, badware, malware, scumware on any TLD<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#106">FAQ 106</a> Use regular expressions in BlockedKeywordsFile<br>

<br>
<br>
<br>

<a name="115"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 115: Block sites from being accessed by IP address</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Typically you add IP blocking in your firewall/router (using ACL's) but these lists can become huge and difficult to manage.<br>
<br>
To ensure all sites are resolved via DNS you can restrict the browser from reaching any site via IP address directly.<br>

<h4>Resolution</h4>
Cisco ASA 55xx series firewall<br>
- See <a target="_blank" href="/sample/CiscoASA/IP-in-URL-block.txt">command-line</a> configuration.<br>
Enabling this feature does not require any additional license.<br>
<br>
ZyXEL ZyWALL USG 20/20W/50/100/100-PLUS/200/300/1000 firewalls<br>
ZyXEL ZyWALL USG 40/40W/60/60W/110/210/310/1900 firewalls (newer)<br>
(not available on [non-USG] 110/310/1100 "VPN" firewalls)<br>
- See screenshot of the <a target="_blank" href="/sample/Zyxel/ZyWallUSG_ ContentFilter_ General.gif">General</a>
and <a target="_blank" href="/sample/Zyxel/ZyWallUSG_ ContentFilter_ FilterProfile.gif">Filter Profile</a> configuration.<br>
Enabling this feature does not require any additional license.<br>
<br>
IE URL Lock software<br>
- See <a href="https://drive.google.com/drive/folders/1HjoUmJ2Fv0_bbnbpU-E1A7i022Q2TgKZ">screenshot and configuration</a> steps.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#34">FAQ 34</a> Prevent the use of other DNS servers<br>

<br>
<br>
<br>

<a name="116"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 116: Allow additional sites based on time of day</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You may want to allow additional sites (that would otherwise be blocked) during certain times of the day.<br>
For example, allow employee's to access their personal webmail, facebook, or myspace accounts during lunchtime.<br>
<br>
Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">allowmore.zip</a><br>
<br>
Assuming dnsredir.ini is set so...<br>
AllowedKeywordsFile=allowed.txt<br>
<br>
allow-more.bat ...edit this file, when run it will insert additional domains in your allowed list<br>
allow-less.bat ...run this to withdraw the additions and revert back to your normal allowed list<br>
<br>
You can automate the time additional sites are allowed or withdrawn by using...<br>
Administrative Tools > Task Scheduler<br>
...define the program as C:\DNSREDIR\allow-more.bat and the start in or working directory as C:\DNSREDIR<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#128">FAQ 128</a> Time restriction options<br>
<a href="full-FAQ.md#57">FAQ 57</a> Keeping kids on track<br>

<br>
<br>
<br>

<a name="117"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 117: Use the same block page as OpenDNS</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
If your upstream DNS provider is <a target="_blank" href="http://www.opendns.com">OpenDNS</a>, 
you can elect to use the same block page as provided by OpenDNS, instead of running your own blocked page on a local Apache or IIS server.<br>
<h4>Resolution</h4>
From a machine that uses OpenDNS as it's resolver, go to a command-line and enter:<br>
nslookup block.opendns.com<br>
...this will return the IP address of the block site, which can be specified for BlockedIP= in dnsredir.ini<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#40">FAQ 40</a> Use with OpenDNS<br>

<br>
<br>
<br>

<a name="118"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 118: Provide pages for phone/mobile device browsers</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Modern devices allow the user to scale the screen or zoom in/out so the page is readable, 
whereas older devices have trouble rendering a page that was designed for a typical computer screen.<br>
<br>
There are a few methods to ensure your welcome and/or blocked page looks good on mobile devices.<br>
<br>
A) use a custom meta tag in the HTML of the page, such as:<br>
meta name "HandheldFriendly"<br>
meta name "MobileOptimized"<br>
meta name "Viewport"<br>
Suggested: meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no;"<br>
See: <a target="_blank" href="http://blogs.msdn.com/b/iemobile/archive/2010/11/22/the-ie-mobile-viewport-on-windows-phone-7.aspx">MSDN article</a>
 | <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Mobile/Viewport_meta_tag">MDN article</a>
 | <a target="_blank" href="http://en.wikipedia.org/wiki/LungoJs">LungoJs example</a><br>
<br>
B) use the browser <a target="_blank" href="http://en.wikipedia.org/wiki/User_agent">user agent</a> to redirect to an alternate page:<br>
Code sample: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">wwwmobile.zip</a><br>
This ASP code could be added to the very top of the default document in your welcome and/or blocked site. 
It redirects the browser to a new page you must create (mobile.asp) which should be formatted to display nicely on older mobile browsers.<br>
See: <a target="_blank" href="http://www.google.com/search?q=list+of+user+agents">list of user agents</a><br>

<br>
<br>
<br>

<a name="120"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 120: Enable MakeRequest function of the Blocked site</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
On some Windows 2003/2008 servers it is necessary to install "Microsoft Exchange Server MAPI Client and Collaboration Data Objects 1.2.1"<br>
Downloaded as: <a target="_blank" href="http://www.microsoft.com/en-us/download/details.aspx?id=1004">ExchangeMapiCdo.exe</a><br>
Run this file to extract, then install ExchangeMapiCdo.msi<br>
<br>
After installing, register the .dll by running this command:<br>
regsvr32 "C:\WINDOWS\system32\cdosys.dll"<br>
<br>
In the root of your blocked site, modify \email.asp (near bottom of the file) to include (uncomment) the .Configuration.Fields.Item lines as shown below...<br>
<br>
With objCDO<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Item ("http://schemas.microsoft.com/cdo/configuration/sendusing") = 2<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Item ("http://schemas.microsoft.com/cdo/configuration/smtpserver") = "yoursmtpserver.example.com"<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Item ("http://schemas.microsoft.com/cdo/configuration/smtpserverport") = 25<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Item ("http://schemas.microsoft.com/cdo/configuration/smtpusessl") = False<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Item ("http://schemas.microsoft.com/cdo/configuration/smtpconnectiontimeout") = 60<br>
&nbsp;&nbsp;&nbsp;.Configuration.Fields.Update<br>
&nbsp;&nbsp;&nbsp;.To = strTo<br>
<br>
Update "yoursmtpserver.example.com" with the IP or hostname of your SMTP server which is allowed to relay email.<br>
<br>
On a 64-bit server running IIS, in the Advanced Settings of the application pool for your blocked site, set Enable 32-Bit Applications: True (as <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">shown in IIS7-Enable32BitAppOnWin64.gif</a>)<br>
<br>
For other issue see 
<a target="_blank" href="https://blogs.msdn.microsoft.com/akashb/2010/05/24/errorcdo-message-1-0x80040220-the-sendusing-configuration-value-is-invalid-on-iis-7-5/">here</a>
and
<a target="_blank" href="https://support.microsoft.com/en-us/help/910360/how-to-troubleshoot-the-could-not-create-cdo.message-error-message">here</a>.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#76">FAQ 76</a> Using the suggested blocked site in IIS<br>

<br>
<br>
<br>

<a name="121"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 121: Useful AuthKeywordsFile additions</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Depending on your network setup/policy you may find the following AuthKeywordsFile= additions useful.<br>
In implementations such as an airport or hotel this can help avoid calls to your help desk.<br>
<br>
vpn.<br>
vpncli<br>
tunnel.<br>
...this will allow most corporate VPN users to connect, without first having to launch a browser to become authorized.<br>
<br>
.nintendowifi.net<br>
...this will allow Nintendo Wii, Nintendo DS, and Nintendo 3DS gaming devices to use the Internet without first having to 
launch a browser to become authorized.<br>
<br>
.xbox.com<br>
xboxlive.com<br>
XBOXLIVE.COM<br>
...this will allow Microsoft Xbox 360 console's to use the Internet without first having to 
launch a browser to become authorized.<br>
<br>
playstation.net<br>
...this will allow Sony PlayStation 3 and PSP gaming devices to use the Internet without first having to 
launch a browser to become authorized.<br>
<br>
eye.fi<br>
...this will allow Eye-Fi wireless SD cards to connect and upload photos.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#159">FAQ 159</a> Useful AllowedKeywordsFile or AlwaysKeywordsFile additions<br>

<br>
<br>
<br>

<a name="123"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 123: How to configure the SWMonDNSR Service</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The SWMonDNSR Service is used to change the DNS Redirector configuration based on a key switch, other hardware dry contacts, or a network fault. 
See <a target="_blank" href="https://drive.google.com/drive/folders/1xfFpZ02QotR5JqbDMXnsMBRVBL3rh_Cl">WebRelay usage examples</a>.<br>
<br>
1) Install <a href="full-FAQ.md#108">.NET Framework 4.x</a><br>
<br>
2) Install <a href="https://github.com/JPElectron/SWMon">SWMonDNSR</a> Service<br>
<br>
3) Make a copy of your dnsredir.ini file named dnsredir-backup.ini<br>
<br>
4) Make a copy of your dnsredir.ini file named dnsredir-red.ini<br>
<br>
5) dnsredir-red.ini will be put into effect whenever the keyswitch is put in the Red position, modify this to do what you want.<br>
ExampleA: Use SimpleDNS= with an asterisk record to resolve everything to an "Internet Off" message<br>
ExampleB: Use BlockedKeywordsFile= with just a . in it to block everything, see <a href="full-FAQ.md#5">FAQ 5</a><br>
<br>
6) Modify C:\SWMONDNSR\swmondnsr.ini with the correct IP and password of your switch hardware,<br>
other settings have been pre-configured for use with DNS Redirector<br>
<br>
7) Ensure your switch hardware is in the Green position.<br>
<br>
8) Start the SWMonDNSR service<br>
...or do this via command-line: sc start swmondnsr<br>
<br>
When the key is put in the Red position, dnsredir-red.ini is put into effect.<br>
When the key is returned to the Green position, the original dnsredir.ini is returned to operation.<br>

<br>
<br>
<br>

<a name="124"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 124: Software stops unexpectedly</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Temporarily set Logging=Full in dnsredir.ini, re/start the software, then scroll to the bottom of today's log file for more information.<br>
<br>
If you are over license, an error might appear in any of the C:\DNSREDIR\DailyLogs files such as:<br>
&nbsp;&nbsp; [License] Concurrent client license exceeded, please purchase a sufficient license.<br>
or if you go 15% over your licensed number of clients...<br>
&nbsp;&nbsp; [License] Concurrent client license exceeded, please purchase a sufficient license.<br>
&nbsp;&nbsp; [License] Exiting because of insufficient license.<br>
&nbsp;&nbsp; [Initialize] DNS Listener has been stopped<br>
Upgrade to the latest version of DNS Redirector to resolve this issue.<br>
<br>
Check for other software/services that monopolize UDP port 53.<br>
<br>
Check for firewall or anti-virus software that may be blocking or rate-limiting connections to DNS Redirector.<br>
<br>
Make an exclusion in your anti-virus software for the C:\DNSREDIR working directory and all subfolders.<br>
<br>
Wait for <a href="full-FAQ.md#168">FAQ 168</a> .NET optimization to finish.<br>
<br>
Run Windows/Microsoft Update to get all remaining .NET updates<br>
Restart the computer after installation of .NET Framework/updates, even if the installer did not prompt you to, this finishes updating system files.<br>

<br>
<br>
<br>

<a name="125"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 125: Service will not install, or batch files will not run</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
When installing the service you receive an error, possibly referencing "HRESULT: 0x80131515"<br>
<br>
Batch files do not run, or do not run correctly.<br>
<h4>Cause</h4>
Windows does not trust the extracted files because it doesn't know where they came from.<br>
<h4>Resolution</h4>
Right-click, and select Properties on the file you downloaded<br>
Click the Unblock button (if this button is not present just proceed), then OK<br>
Extract the contents to C:\DNSREDIR replacing all files (make a backup any .ini files first)<br>
<br>
Executables, DLL's and batch files are then allowed to run.<br>
Note that some .bat files will still require that you right-click and select "Run as administrator"<br>
<br>
Run fixNTFS.bat first, then run dnsrsvc-install.bat to install the service.<br>

<br>
<br>
<br>

<a name="126"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 126: Best practices for public networks</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
When providing Internet access to the public (wired and/or wireless connections) here's a few things to keep in mind...<br>
<br>
1) DNS Redirector only manipulates DNS, and intentionally no other traffic; if you want to create a fair usage scenario invest in a hardware 
firewall/router that allows for QoS rules (to limit/guarantee minimum bandwidth per-client) and packet inspection (to limit P2P/file-sharing 
and other bandwidth intensive applications) for example...<br>
<a target="_blank" href="http://www.cisco.com/en/US/products/ps6120/index.html">Cisco ASA 55xx series</a><br>
<a target="_blank" href="http://www.cisco.com/en/US/products/ps9923/index.html">Cisco Small Business RV1x, RV2x, or RV3x series</a> (do not pick the older RV0x series)<br>
<a target="_blank" href="http://www.peplink.com/products/balance/model-comparison">Peplink Balance series</a><br>
<a target="_blank" href="http://www.zyxel.com/us/en/products_services/smb-security_appliances_and_services.shtml?t=c">ZyXEL ZyWALL USG series</a><br>
<br>
2) Don't overload your access points; an access point is like a hub and your average AP with a 10/100 Ethernet port can sustain around 24 
clients depending on bandwidth usage.<br>
<br>
3) Use only non-overlapping channels 1, 6, and 11. Other channels, including those used by neighboring networks that you cannot control, 
may interferer with the performance of your network.<br>
<br>
4) Keep your internal/office network completely separate from the guest network to prevent hacking, see 
<a href="https://drive.google.com/drive/folders/1KNDQZk0YMj6DSHv7fAJYGYBwAFhcyvd8">Network Examples</a>.<br>
<br>
5) Are you legally allowed to resell or distribute Internet provided by your ISP? Check your SLA or TOS first.<br>
<br>
6) Are you required to retain the MAC address and IP of clients who connect? This may be used (or in some jurisdictions required) by law 
enforcement to determine abuse or violation of network policies, see <a href="full-FAQ.md#62">FAQ 62</a>.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#65">FAQ 65</a> Best practices for speedy DNS resolution<br>

<br>
<br>
<br>

<a name="128"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 128: Time restriction options</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7.0.0.x and prior had some INI settings that forced all clients to be redirected to an "after hours" page.<br>
<br>
In DNS Redirector v7.1.0.x and later this has been discontinued in favor of using a more robust solution; a Windows Scheduled Task.<br>
<br>
For example:<br>
- you don't want people parking around your building and using your HotSpot during non-business hours<br>
- you want to prevent a cleaning crew from using your Internet late at night<br>
- you want to turn off Internet access so your kids get so bored they actually go to sleep<br>
<br>
Make a copy of your dnsredir.ini file and call it dnsredir-normal.ini<br>
Make a new file called dnsredir-restrict.ini configured to do whatever you want<br>
Make a new file called restrict.bat<br>
<br>
The restrict.bat file should:<br>
a) copy dnsredir-restrict.ini to dnsredir.ini (replacing the existing)<br>
b) restart the software/service to make the change active<br>
<br>
You can automate the time this restriction becomes active by using...<br>
Administrative Tools > Task Scheduler<br>
...define the program as C:\DNSREDIR\restrict.bat and the start in or working directory as C:\DNSREDIR<br>
<br>
Later on, use another scheduled task to run a batch file to:<br>
a) copy dnsredir-normal.ini to dnsredir.ini (replacing the existing)<br>
b) restart the software/service to make the change active<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#116">FAQ 116</a>Allow additional sites based on time of day<br>
<a href="full-FAQ.md#57">FAQ 57</a> Keeping kids on track<br>

<br>
<br>
<br>

<a name="129"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 129: NTFS permissions required</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
File permissions can be re-applied automatically, right-click on fixNTFS.bat and select "Run as administrator"<br>
<br>
When manually setting permissions the application working directory (usually C:\DNSREDIR) requires the following NTFS permissions:<br>
<br>
Administrators = Full Control<br>
LOCAL SERVICE = Full Control<br>
SYSTEM = Full Control<br>

<br>
<br>
<br>

<a name="137"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 137: Use for self-guided tours</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In 2011 a customer let us know they're using DNS Redirector to facilitate a self-guided tour at their historical property 
(this would also work for museums or art galleries), the system works like this...<br>
<br>
Guests arrive at a sign which asks them to use their mobile device and connect to an open wireless network, then visit www.example.com 
This wireless network has no Internet connection, patrons can only access the website running locally on the DNS Redirector server. 
No matter where the user tries to surf, they are redirected back to www.example.com which contains bullet points or links describing the 
other areas they should visit. For example, when the user arrives at a sign labeled "This is area 4, use your mobile device to select area 4 now" 
the webpage could display text/picture information about the exhibit, or link to audio/video which will play on the user's device.<br>
<br>
DNS Redirector staff would like to thank those who implement this type of system; besides being all-around cool and providing rich information, 
visitors no longer have to be afraid of germs or lice from using typical rented audio headsets.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#159">FAQ 159</a> Useful AllowedKeywordsFile or AlwaysKeywordsFile additions<br>

<br>
<br>
<br>

<a name="138"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 138: Non-payment notice</h3><font size=1>Category: No-Internet</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
A wireless ISP says he's using DNS Redirector to give non-paying customers a chance to pay-up and instantly restore service, 
all without placing a support call...<br>
<br>
Once a month he makes a list of all the customers who haven't paid, then goes into their wireless radio and changes the DNS server there to 
be the IP of the DNS Redirector server. The DNS Redirector server is implemented as a standard captive portal, redirecting all web requests 
to a "You haven't paid, would you like to do so now?" page. The only sites the user is allowed to visit are the ISPs site and PayPal. 
After a successful payment, the user is marked as authorized in DNS Redirector and can surf freely. Later that night he reviews the PayPal 
emails from people who recently paid, then goes back into the customer's radio and puts back the normal DNS server.<br>
<br>
DNS Redirector staff believes this system is infinitely more friendly and empowers the customer to correct their own oversight, 
rather than place a support call to complain their service isn't working.<br>

<br>
<br>
<br>

<a name="139"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 139: What to name your SSID</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Many admins are asking us if there is a standard to naming your wireless network, we don't know of any set standard but here is our suggestion.<br>
<br>
If the network is for free wireless Internet, and provided by a company named Contoso, then the SSID would be...<br>
&nbsp; freewifi-contoso<br>
<br>
If you don't want your access point used by <a target="_blank" href="http://support.google.com/maps/bin/answer.py?hl=en&answer=1725632">Google Location Service</a> add _nomap to the end...<br>
&nbsp; freewifi-contoso_nomap<br>
<br>
If the network is paid access...<br>
&nbsp; paidwifi-contoso<br>
<br>
If the network is for internal use only you should identify it as such, and in a way so it will appear lower in the list than a public network...<br>
&nbsp; private-contoso<br>
or...<br>
&nbsp; x-internal-contoso<br>
<br>
Ideally, an internal network would use a WPA2 key and have SSID broadcast set disabled so this name won't appear to most users, 
however it should not be assumed it is completely hidden to those that know what they're doing.<br>
<br>
To ensure compatibility with different client devices the SSID should not be more than 31 characters.<br>

<br>
<br>
<br>

<a name="142"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 142: Valid DNS resolution paths</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Examples of different DNS resolution paths are shown here. Functional limitations exist when clients are separated from 
the DNS Redirector server by other DNS servers or NAT firewall/routers, details are explained at the end of this article.<br>
<br>
<img border="0" src="https://raw.githubusercontent.com/JPElectron/DNSRedirOSS/main/DNS-ResolutionPaths.gif" align="absmiddle" width="755" height="865"><br>
<br>
1:&nbsp;&nbsp; Acceptable, but consider that the DNS Redirector server and clients are not protected by any firewall to the Internet.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This also limits your ability to enforce DNS Redirector as the only DNS server, as described in <a href="full-FAQ.md#34">FAQ 34</a>.<br>
<br>
2:&nbsp;&nbsp; Correct, this is the ideal implementation for a public/wireless network.<br>
<br>
2b: Warning: NAT prevents the DNS Redirector server from tracking individual clients by their own/unique IP address, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; only the IP of the NAT device will be seen.<br>
<br>
3:&nbsp;&nbsp; Correct, this is the ideal implementation for a company network. Note that DNS Redirector could be run on your Active Directory (AD) Domain Controller (DC), <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; it does not have to be a separate server, see <a href="full-FAQ.md#91">FAQ 91</a>.<br>
<br>
3b: Warning: Internal DNS server first prevents the DNS Redirector server from tracking individual clients by their own/unique IP address, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; only the IP of the internal DNS server will be seen.<br>
<br>
4:&nbsp;&nbsp; Acceptable, assuming each client has a public IP address, and therefore the router is not doing NAT.<br>
<br>
4b + 4c: Warning: NAT prevents the DNS Redirector server from tracking individual clients by their own/unique IP address, <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; only the IP of the NAT device will be seen.<br>
<br>
In any case where "Warning" appears above, the limitations below are applicable to DNS Redirector <i>software</i>:<br>
RedirectIP= (captive portal function) if this were implemented, the first client which is redirected to the welcome site and becomes authorized, 
would cause everyone to be authorized and web-surf.<br>
BlockedIP= (Internet filtering function) will work regardless, but if BypassBlockFile= were implemented, 
the first client to toggle bypassing would cause everyone to web-surf unrestricted.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#37">FAQ 37</a> Use when clients are behind a NAT device<br>

<br>
<br>
<br>

<a name="143"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 143: ClientTimeout setting explained</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
ClientTimeout= is the number of minutes that must pass without any DNS requests from the client, after which that client is considered gone from the network. 
When a client is gone they are removed from the online clients list, this inherently de-authorizes the client, re-enables the block, and executes a LeaveAction if set. 
After this timeout, a client who starts generating DNS traffic again (regardless of same or different IP lease) will get redirected again.<br>
<br>
Consider that depending on location, the typical stay (or time spent online) of a client is different. 
For example, at a library the typical stay might be 1 hour or more whereas at a fast food place the typical stay might be only 20min. 
In many cases you may want to extend the default "ClientTimeout=20" minutes to be equal to the typical stay, this can avoid client frustration of being redirected before their stay is over. 
Setting the ClientTimeout appropriately avoids wasting concurrent client counts on client's who are no longer there.<br>
<br>
Ideally, your DHCP lease time would be set the same as the ClientTimeout value, this avoids wasting IP address allocations on clients who are no longer there.<br>
<br>
<h4>What the ClientTimeout setting is not...</h4>
Some administrators have asked how to force clients to be redirected after a set time; 
example A) the client is paying for 30min. of Internet after which they should then be redirected again, 
or example B) a nearby/neighborhood resident is using your free hotspot continually.<br>
<br>
A) The ClientTimeout is intentionally not implemented as a ForcedTimout.&nbsp;
Lets say the client is granted use of the hotspot for a half-hour. 
Later the half-hour expires but the end-user was still in the middle of composing a message in webmail, or ordering something online, or writing in a comment box or forum.&nbsp;
When the user clicks send, their work/progress <i>may</i> be lost because they <i>may</i> be redirected. 
The redirect cannot be guaranteed because different OS's and browsers will very likely cache the DNS lookups and/or web-pages. 
Implementing this would frustrate end-user's either because they lost work or because an inequality is created when other users seemingly get more access time. 
Regardless, this is not terribly friendly and makes some people very upset.<br>
<br>
B) When the DNS Redirector software is restarted, the status of all clients is forgotten and all clients are treated as new. 
Depending on the client OS and browser, recent DNS lookups and/or web-pages may still be accessible for a short time. 
Certainly, when a client visits a unique site they haven't visited before or closes and opens their browser they would get redirected again. 
You can restart (or stop) the DNS Redirector service nightly, effectively kicking off all clients, 
either by checking "Run updaterdone.bat when done" (if using <a href="full-FAQ.md#52">Updater</a>) or by adding a scheduled task to run updaterdone.bat directly.<br>
<br>
If experiencing trouble from a particular client you may consider blocking their MAC address in the access point or router, but be aware that savvy users may be able to change their MAC to something else. 
Some hotspot operators choose to display a code, either on a sign within their business or on a receipt, which patrons enter on the redirect page in order to gain Internet access.<br>

<br>
<br>
<br>

<a name="145"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 145: HTTPS website compatibility</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector blocks both HTTP and HTTPS (secure) sites and/or apps because either are resolved using DNS.<br>
<br>
There is a limitation that any HTTPS site which is blocked will not display your blocked page, as served by IIS on the DNS Redirector server.<br>
This is because nobody should be forging an SSL certificate (the blocked page, as served by IIS, would need to forge the real site's SSL cert in order to display anything besides an error in the browser).<br>
<br>
In some cases you will be able to see the blocked page if you change the https:// to http:// in the browser address bar.<br>
However, if the site uses <a target="_blank" href="https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security">HTTP Strict Transport Security (HSTS)</a> then the browser will never allow the site to load via http:// and you will never be able to see the blocked page, as served by IIS.<br>
You can learn more, including a list of sites that use HSTS, at the <a target="_blank" href="https://www.chromium.org/hsts">Chromium projects page for HSTS</a>.<br>
<br>
Note that answering the HTTPS request (albeit incorrectly) is faster than no response at all, in which the browser connection waits to timeout.<br>
The options below ensure that a blocked HTTPS domain will not cause the browser/website to load slowly as it is attempting a HTTPS connection...<br>
<br>
Option A) Run SimpleHTTP on port 443 (the HTTPS port) which will reject the request<br>
<br>
&nbsp;&nbsp; 1) Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">SimpleHTTP-rejectHTTPS.zip</a> and extract to C:\SIMPLEHTTP<br>
&nbsp;&nbsp; 2) Right-click on the .zip file you downloaded, select Properties, click the Unblock button (if this button is not present just proceed), click OK<br>
&nbsp;&nbsp; 3) Change simplehttp.ini IP=[value] to match dnsredir.ini BlockedIP=[value]<br>
&nbsp;&nbsp; 4) Run: SimpleHTTP-install.bat&nbsp; and follow the on-screen instructions<br>
<br>
Option B) Enable your welcome or blocked site with a Self-Signed Certificate<br>
<br>
For IIS 6...<br>
&nbsp;&nbsp; 1) Install: <a target="_blank" href="http://www.microsoft.com/en-us/download/details.aspx?id=17275">Internet Information Services (IIS) 6.0 Resource Kit Tools</a><br>
&nbsp;&nbsp; 2) Create the cert and apply it to your site in IIS...<br>
C:\Program Files\IIS Resources\SelfSSL>selfssl /N:CN=[yoursite.example.com] /K:2048 /V:365 /S:[Identifier_number_in_IIS] /T<br>
Replace [yoursite.example.com] with your own FQDN for this site<br>
Replace [Identifier_number_in_IIS] with the number as it appears in the IIS Management console<br>
&nbsp;&nbsp; 3) Ensure the SSL site is bound to a static IP address assigned to the server...<br>
In the IIS Management console, right-click on the website<br>
Go to "Properties"<br>
Under the first "Web Site" tab click the "Advanced..." button<br>
Under the second section "Multiple SSL identities for this Web site" click the "Edit" button<br>
Select the same IP address as defined for the port 80 site<br>
<br>
For IIS 7...<br>
&nbsp;&nbsp; 1) Follow the instructions: <a target="_blank" href="http://technet.microsoft.com/en-us/library/cc753127(v=ws.10).aspx">Create a Self-Signed Server Certificate in IIS 7</a><br>
&nbsp;&nbsp; 2) Bind the SSL cert to a site...<br>
In the IIS Management console, click on the website<br>
On the right Actions pane click "Bindings..."<br>
Click the "Add" button<br>
Type: https: | IP address: (the same IP address as defined for the port 80 site) | Port: 443<br>
SSL certificate: (pick the cert you created)<br>

<br>
<br>
<br>

<a name="147"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 147: Use with Remote Desktop Services (Terminal Services)</h3><font size=1>Category: Initial setup</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
When used with Remote Desktop Services (RDS) on Windows Server 2008 R2 (and later) you should <a target="_blank" href="http://technet.microsoft.com/en-us/library/dd759263.aspx">Enable IP virtualization, Per session</a>.<br>
<br>
When used with Windows MultiPoint Server 2011 you should <a target="_blank" href="http://technet.microsoft.com/en-us/library/gg609267.aspx">Assign a unique IP to each station</a>.<br>
<br>
...with either configuration, all DNS Redirector features are then supported.<br>
<br>
With previous server versions, all terminal server users share the IP of the server itself. 
Thus DNS Redirector is unable to track each client by it's own/unique IP address. 
For this reason, RedirectIP= (and associated settings) cannot not be used. 
The BlockedIP= setting may be used, but BypassBlockFile= cannot.<br>

<br>
<br>
<br>

<a name="148"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 148: Quickly change your network preferences</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
To be authorized on a wireless hotspot the user's device must be able to obtain a DHCP lease including your DNS server. 
Some users may come onto your network with a DNS server set statically on their machine, which <a href="full-FAQ.md#34">may render them unable to surf</a>.<br>
<br>
Windows (XP and later):<br>
Start > Run > cmd<br>
netsh int ip delete dns "Local Area Connection" all<br>
netsh int ip set dns "Local Area Connection" dhcp<br>
netsh int ip delete dns "Wireless Network Connection" all<br>
netsh int ip set dns "Wireless Network Connection" dhcp<br>
<br>
...the connection names must match each network adapter in the PC.<br>
You could add these commands to a batch file along with a desktop shortcut to make it easy for the user to switch.<br>
<br>
<br>
Apple users:<br>
Setup a <a target="_blank" href="http://support.apple.com/kb/HT2712">network location</a> named "HotSpot" where the DHCP and DNS is set to automatic.<br>
Then change to these settings easily by selecting Apple menu > Location > HotSpot<br>

<br>
<br>
<br>

<a name="149"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 149: Device Self-Registration</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The Device Self-Registration website, useful in <a target="_blank" href="http://en.wikipedia.org/wiki/Bring_your_own_device">BYOD</a> environments, 
requires your employees and/or students to register their device before they can gain network access.<br>
The end-user is asked to provide the following information:<br>
<br>
 - Employee or student ID number<br>
 - First name<br>
 - Last name<br>
 - Type of device<br>
<br>
See <a href="https://drive.google.com/drive/folders/1x3jgNTCCE0219DVSlh3Gg25_ME4Eyjdt">sample screenshots</a><br>
<br>
The site saves this information along with the current IP of their device, MAC address, 
browser user-agent (useful to determine the device type or patch level) and last seen date/time. 
When the end-user returns to the network the next day, they need only enter their ID number (assuming they have already registered that device) 
The site allows administrators to deny any device from returning, or deny a user from registering any more devices. 
You can also search for devices by IP or MAC, see all the devices a user has registered, and see which devices are most popular.<br>
<br>
Download: <a href="https://drive.google.com/drive/folders/1eQfkyGuYV4xBnIrmHiEkForWe7Esasqv">welcome -devicereg.zip</a><br>
The latest is: v2.1 r05/12/2014<br>
<br>
Right-click the .zip file you just downloaded:<br>
&nbsp;&nbsp;Select properties<br>
&nbsp;&nbsp;Click the Unblock button (if this button is not present just proceed), then OK<br>
&nbsp;&nbsp;Extract the contents to C:\inetpub<br>
<br>
Follow the instructions in C:\inetpub\devicereg\App_Data\readme.htm<br>

<br>
<br>
<br>

<a name="150"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 150: How to backup your DNS Redirector server</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Simply backup the following folders...<br>
<br>
c:\dnsredir&nbsp; (all files and subdirectories)<br>
c:\inetpub&nbsp; (all files and subdirectories)<br>
<br>
For IIS 6 you must first <a href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/131b609d-ff3a-488f-a8dd-13044fa623a1.mspx">create a metabase backup</a> (a portable backup with a password) and then include the resulting file in...<br>
c:\windows\system32\inetsrv\MetaBack&nbsp; (all files and subdirectories)<br>
<br>
For IIS 7.x and later include the following...<br>
c:\windows\system32\inetsrv\config&nbsp; (all files and subdirectories)<br>

<br>
<br>
<br>

<a name="152"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 152: Problems with Server 2012 or 2016</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
DNS Redirector v7.2.0.11 and later are fully supported on Windows Server 2012 and 2016, however some customers have reported a few issues with installation...<br>
<br>
The installation appears to hang at...<br>
&nbsp;&nbsp; Configuring Windows features<br>
&nbsp;&nbsp; Configuring Internet Information Services<br>
Solution: be patient as the install will complete. On slow systems or those with many updates installation of the extra Windows components may take awhile.<br>
<br>
When visiting any site you get:&nbsp; HTTP Error 503. The service is unavailable<br>
Solution: verify that in IIS, under each application pool, the .NET Framework is set to v4.0<br>
Solution: verify that no other software is running a website on port 80.<br>
<br>
Batch files or other software won't run because it needs administrator privileges, even though you are logged on as a user with admin rights.<br> 
Solution: right-click on the file and pick "Run as administrator"<br>
<br>
Batch files that contain %CD% (normally meaning use the Current Directory) sometimes have problems finding the current directory.<br>
Solution: use the latest batch files distributed with the software, or find/replace %CD% with the actual directory, for example C:\DNSREDIR<br>
<br>
User Account Control (UAC) should be disabled.<br>
Solution: disable it<br>
<br>
Virus scan software should be excluded from real-time scans of the working directory.<br>
Solution: disable it<br>

<br>
<br>
<br>

<a name="153"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 153: Using the suggested welcome site in IIS</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The sample "welcome -suggested.zip" can be implemented in the following ways...<br>
<br>
 - Simply redirect to a publicly hosted website, with or without authorizing the user device to reach the Internet<br>
 - Display your corporate website (or a special public site/page used just for HotSpots) and authorize the user device to reach the Internet<br>
 - Prompt users for a common password before they can reach the Internet (such a password provided by your receptionist or a sign on the wall)<br>
 - Ask users to fill out a survey
 - Ask users to agree to a terms of service statement<br>
<br>
Extract the .zip to the directory of your "welcome" site (usually C:\inetpub\welcome)<br>
<br>
Configuration is done by editing \global.asa as instructed in the file<br>
<br>
Application("PublicWebsite") does not have to be set to a domain name starting with "www."<br>
It can also include a path such as "www.example.com/folder/page5.htm"<br>
When specifying an external site, the domain must be listed in your AlwaysKeywordsFile= to allow it to resolve to the Internet 
(even before the user device is authorized) otherwise the redirect is stuck in a loop.<br>
<br>
If enableing the survey, accounts IIS_IUSRS and IUSR must be granted NTFS modify permission to the \data.csv file<br>
<br>
Modify \askterms.asp with your own Terms of Service statement<br>
<br>
Modify \okdone.asp to display a custom message or other information once the user device is authorized<br>

<br>
<br>
<br>

<a name="154"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 154: Show the number of clients on a LCD display</h3><font size=1>Category: Action functions</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The LCD display can be used to show the number of clients online and authorized.<br>
<br>
Download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">JoinAction-lcddisplay.zip</a> v1.6 r10/15/2013<br>
When connecting the LCD to the server, extract the files to the same folder as your DNS Redirector installation<br>
When connecting to any other computer, make a new folder and extract the files there<br>
<br>
<br>
If you have the single color (Blue or Yellow) display...<br>
&nbsp;&nbsp; Run lcdsc-driver-install.exe - then plug in your LCD display<br>
&nbsp;&nbsp; Modify dnsredir.ini as follows:<br>
&nbsp;&nbsp; ActionNumber=1<br>
&nbsp;&nbsp; JoinAction=C:\DNSREDIR\lcdsc-update.bat<br>
&nbsp;&nbsp; LeaveAction=C:\DNSREDIR\lcdsc-update.bat<br>
<br>
<br>
If you have the multi color (RGB) display...<br>
&nbsp;&nbsp; Run lcdmc-driver-install.exe - then plug in your LCD display<br>
&nbsp;&nbsp; Edit the lcdmc*.bat files with the COM port of your unit...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Find it under Device Manager > Ports (COM & LPT) > Communications Port (COM#)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It will probably be the highest number COM port, but if you right-click, Properties,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Driver tab, the Driver Provider should read "DNSRedir"<br>
&nbsp;&nbsp; Modify dnsredir.ini as follows:<br>
&nbsp;&nbsp; ActionNumber=1<br>
&nbsp;&nbsp; JoinAction=C:\DNSREDIR\lcdmc-update.bat<br>
&nbsp;&nbsp; LeaveAction=C:\DNSREDIR\lcdmc-update.bat<br>
<br>
<br>
When connecting the LCD to the server, you can optionally create a Scheduled Task to run lcd*c-startup.bat at startup.<br>
This will show the system IP, then date and time, then CPU load, and after DNS Redirector loads, the client counts.<br>
<br>
When connecting to any other computer you could use a Scheduled Task on that computer to run lcd*c-update.bat every 10 minutes, or<br>
define JoinAction= and LeaveAction= on the server to run a .bat which could use <a target="_blank" href="http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx">psexec.exe</a> to run lcd*c-update.bat on the remote machine.<br>

<br>
<br>
<br>

<a name="156"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 156: Change your DNS to obtain automatically</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Anytime you change your DNS settings you should either...<br>
&nbsp;- restart your computer&nbsp;&nbsp;&nbsp; or...<br>
&nbsp;- close all Internet browsers and <a href="full-FAQ.md#12">flush the DNS cache</a><br>
<br>
<br>
<u>Windows XP, Server 2003 or Windows Home Server</u><br>
<br>
- Open Control Panel<br>
- Open Network Connections<br>
- Right-click on the network adapter you use, select Properties<br>
- In the list you'll find "Internet Protocol (TCP/IP)" select to highlight it, but don't uncheck it<br>
- Click the Properties button<br>
- Click the option button "Obtain DNS server address automatically"<br>
- Click OK, click Close, your computer may think for a second<br>
<br>
<br>
<u>Windows Vista</u><br>
<br>
- Open Control Panel<br>
- Open Network and Sharing Center (if you don't see it, click "Classic View" on the left-hand side)<br>
- On the left-hand side, under Tasks, pick "Manage Network Connections"<br>
- Right-click on the network adapter you use, select Properties<br>
- In the list you'll find "Internet Protocol Version 4 (TCP/IPv4)" select to highlight it, but don't uncheck it<br>
- Click the Properties button<br>
- Click the option button "Obtain DNS server address automatically"<br>
- Click OK, click Close, your computer may think for a second<br>
<br>
<br>
<u>Windows 7 or 8</u><br>
<br>
- Open Control Panel<br>
- Open Network and Sharing Center (if you don't see it, change "View by:" to Small icons)<br>
- On the left-hand side, pick "Change adapter settings"<br>
- Right-click on the network adapter you use, select Properties<br>
- In the list you'll find "Internet Protocol Version 4 (TCP/IPv4)" select to highlight it, but don't uncheck it<br>
- Click the Properties button<br>
- Click the option button "Obtain DNS server address automatically"<br>
- Click OK, click Close, your computer may think for a second<br>
<br>
<br>
<u>Mac OS X</u><br>
<br>
- Go to System Preferences<br>
- Click on Network<br>
- On the left-hand side, pick the network connection you are using (Ethernet or AirPort if using wireless)<br>
- Click the Advanced button<br>
- Use the minus ( - ) button to remove all DNS servers listed in dark black font<br>
- Click OK<br>

<br>
<br>
<br>

<a name="157"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 157: Monitor your DNS Redirector server with PRTG</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You can use <a target="_blank" href="http://www.paessler.com">PRTG</a> to monitor all aspects of your DNS Redirector server, see a <a href="https://drive.google.com/drive/folders/1l7y7cSrMlyf0JrLJEKB4MMJXz9n7yRax">example-prtg-sensors.png</a>.<br>
<br>
Start by creating a new device...<br>
- In PRTG, click Add Device<br>
- Give your server a name, such as:&nbsp; DNS Redirector<br>
- IPv4 Address/DNS Name:&nbsp; (for DNS Redirector <i>software</i> specify the IP you have for ListenOnIP= in dnsredir.ini)<br>
<br>
Note: In the examples below you should replace "example.com" with the DNS suffix of your network, or a domain you own.<br>
<br>
<input type="checkbox" name="1" value="Done"> 1) Create a "DNS Redirector service" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Note: This tests that DNS Redirector is up, and it's response time.</font><br>
- In DNS Redirector, add a new line to your SimpleDNS= file, such as:&nbsp; 10.10.10.10 dnsredir-test.example.com&nbsp; (this can be any IP and made-up FQDN)<br>
- In PRTG, click Add Sensor, DNS<br>
- Give your sensor a name, such as:&nbsp; DNS Redirector service<br>
- Domain:&nbsp; dnsredir-test.example.com<br>
- Check result<br>
- Value:&nbsp; 10.10.10.10<br>
- Scanning Interval:&nbsp; (suggested 5 minutes, meaning if DNS Redirector were to fail, PRTG in the worst case could take 5 minutes to realize it and notify you)<br>
<br>
<input type="checkbox" name="2" value="Done"> 2) Create a "DNS internal service" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Optional: This tests that your internal DNS server is up, and it's response time.</font><br>
- In your internal/caching DNS server, add an A record such as:&nbsp; 10.10.10.20 dnsint-test.example.com&nbsp; (this can be any IP and made-up FQDN)<br>
- In PRTG, click Add Sensor, DNS<br>
- Give your sensor a name, such as:&nbsp; DNS internal service<br>
- Domain:&nbsp; dnsint-test.example.com<br>
- Check result<br>
- Value:&nbsp; 10.10.10.20<br>
- Scanning Interval:&nbsp; (suggested 5 minutes, meaning if your DNS server were to fail, PRTG in the worst case could take 5 minutes to realize it and notify you)<br>
<br>
<input type="checkbox" name="3" value="Done"> 3) Create a "DNS external service" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Optional: This tests that your ISP's recursive DNS service is working, and the response time of DNS for your domain.</font><br>
- In the authoritative DNS server* for a domain you own, add an A record such as:&nbsp; 10.10.10.30 dnsext-test.example.com&nbsp; (this can be any IP)<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">*sometimes called "name servers" or "SOA servers" and may be provided by the registrar where you purchased your domain.</font><br>
- In PRTG, click Add Sensor, DNS<br>
- Give your sensor a name, such as:&nbsp; DNS external service<br>
- Domain:&nbsp; dnsext-test.example.com<br>
- Check result<br>
- Value:&nbsp; 10.10.10.30<br>
- Scanning Interval:&nbsp; (no less than 8 minutes, a more frequent interval may be seen as an attack or rate-limited by your provider, which can lead to false alerts)<br>
<br>
<input type="checkbox" name="4" value="Done"> 4) Create a "HTTP Welcome" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Optional: Only if your DNS Redirector <i>software</i> is used for captive portal, otherwise skip creating this sensor.</font><br>
- In PRTG, click Add Sensor, HTTP<br>
- Give your sensor a name, such as:&nbsp; HTTP Welcome<br>
- URL:&nbsp; http://192.168.x.x&nbsp; (specify the IP you have for RedirectIP= in dnsredir.ini)<br>
- Scanning Interval:&nbsp; (suggested 5 minutes, meaning if the welcome site were to fail, PRTG in the worst case could take 5 minutes to realize this and notify you)<br>
<br>
<input type="checkbox" name="5" value="Done"> 5) Create a "HTTP Blocked" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Optional: Only if your DNS Redirector <i>software</i> is used for Internet filtering, otherwise skip creating this sensor.</font><br>
- In PRTG, click Add Sensor, HTTP<br>
- Give your sensor a name, such as:&nbsp; HTTP Blocked<br>
- URL:&nbsp; http://192.168.x.x&nbsp; (specify the IP you have for BlockedIP= in dnsredir.ini)<br>
- Scanning Interval:&nbsp; (suggested 5 minutes, meaning if the blocked site were to fail, PRTG in the worst case could take 5 minutes to realize this and notify you)<br>
<br>
<input type="checkbox" name="6" value="Done"> 6) Create a "Clients online" sensor...<br>
- Download <a href="https://drive.google.com/drive/folders/1l7y7cSrMlyf0JrLJEKB4MMJXz9n7yRax">DNSRedir get clients online.bat</a> and place in C:\Program Files\PRTG Network Monitor\Custom Sensors\EXE\<br>
- In PRTG, click Add Sensor, Custom Sensors, EXE/Script<br>
- Give your sensor a name, such as:&nbsp; Clients online<br>
- EXE/Script, pick:&nbsp; DNSRedir get clients online.bat<br>
- Parameters:&nbsp; %host<br>
- Mutex Name:&nbsp; dnsr<br>
- Scanning Interval:&nbsp; (this should be half of the number for ClientTimeout= in dnsredir.ini, so probably no less than 10 minutes)<br>
<br>
<input type="checkbox" name="7" value="Done"> 7) Create a "Clients authorized" sensor...<br>
&nbsp;&nbsp;&nbsp;&nbsp; <font face="Verdana" style="font-size: 8.5pt">Optional: Only if your DNS Redirector software is used for captive portal, otherwise skip creating this sensor (value will always be 0)</font><br>
- Download <a href="https://drive.google.com/drive/folders/1l7y7cSrMlyf0JrLJEKB4MMJXz9n7yRax">DNSRedir get clients authorized.bat</a> and place in C:\Program Files\PRTG Network Monitor\Custom Sensors\EXE\<br>
- In PRTG, click Add Sensor, Custom Sensors, EXE/Script<br>
- Give your sensor a name, such as:&nbsp; Clients authorized<br>
- EXE/Script, pick:&nbsp; DNSRedir get clients authorized.bat<br>
- Parameters:&nbsp; %host<br>
- Mutex Name:&nbsp; dnsr<br>
- Scanning Interval:&nbsp; (this should be half of the number for ClientTimeout= in dnsredir.ini, so probably no less than 10 minutes)<br>

<br>
<br>
<br>

<a name="159"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 159: Useful AllowedKeywordsFile or AlwaysKeywordsFile additions</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Since popular services and websites may use many domains or rely on 3rd party <a target="_blank" href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a> domains, 
incorporating an allowed list can avoid disruption to services your company relies on.<br>
Remember that your internal domain suffix should also be included in your allowed file.<br>
<br>
&nbsp;<b>[</b> See a sample allowed file here: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">example-allowed.txt</a> <b>]</b><br>
...the contents can be pasted into your allowed.txt or always.txt file.<br>
<br>
<b>Depending on your network setup/policy you may find the following AllowedKeywordsFile= additions useful...</b><br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
You can make this keyword up and/or make it specific to your network's domain, for example: allowed.inside.example.com<br>
<br>
^.*XETGS\.XBOXLIVE\.COM$<br>
^.*epix\.xbox\.com$<br>
...when implemented for a free/open hotspot at a hotel, add these to your AllowedKeywordsFile=<br>
By allowing these domains, Xbox 360's are not restricted by your blocked list.<br>
Alternatively, to authorize a game console as soon as it connects, see <a href="full-FAQ.md#121">FAQ 121</a>.<br>
<br>
<b>Depending on your network setup/policy you may find the following AllowedKeywordsFile= or AlwaysKeywordsFile= additions useful...</b><br>
Example: Clients connecting to your "block everything" or "no-Internet" network, but some sites still need to be reached.<br>
<br>
For Windows Vista, 7, 8 and Windows Phone to determine Internet connection availability...<br>
^dns\.msftncsi\.com$<br>
(the user's machine finds Internet is available and a pop-up balloon from the system tray will read 
"Additional log on information may be required. Click to open your browser")<br>
- or -<br>
^.*\.msftncsi\.com$<br>
(lookups for both dns.msftncsi.com and www.msftncsi.com will work, and so 
the user's machine finds Internet is available without any additional steps)<br>
<br>
For Windows 10 to determine Internet connection availability...<br>
^(.*\.)?msftconnecttest\.com$<br>
<br>
For Android, Google Chrome, and Chromium OS devices to believe they are not behind a captive portal...<br>
^clients3\.google\.com$&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...also for Android 4.4.x (Kitkat)<br>
<!-- full URL for test: http://[domain]/generate_204 -->
^connectivitycheck\.android\.com$&nbsp;&nbsp; ...for Android 5.0/5.1.x<br>
^connectivitycheck\.gstatic\.com$&nbsp;&nbsp;&nbsp; ...for Android 6.0.x (Marshmallow)<br>
<br>
For Apple iOS devices to believe they are not behind a captive portal...<br>
^(.*\.)?apple.com<br>
^captive\.apple\.com$<br>
^(.*\.)?appleiphonecell\.com$<br>
^(.*\.)?itools\.info$<br>
^(.*\.)?ibook\.info$<br>
^(.*\.)?airport\.us$<br>
^(.*\.)?thinkdifferent\.us$<br>
<!-- full URL for test: http://www.[domain_above]/library/test/success.html -->
<br>
For Firefox OS devices to believe they are not behind a captive portal...<br>
^detectportal\.firefox\.com$<br>
<!-- full URL for test: http://detectportal.firefox.com/success.txt -->
<br>
For browsers that may encounter trouble with HTTPS sites if/previously behind a captive portal...<br>
^(.*\.)?symcd\.com$<br>
^((.*-)?crl|crl-ssl)\d?\.\w*\.(com|net|\w{2}\.\w{2})$<br>
^(ms)?crl\.microsoft\.com$<br>
^www\.startssl\.com$<br>
^pki\.(google|nai)\.com$<br>
^repo\d\.secomtrust\.net$<br>
^.*ocsp2?\.\w*\.(com|net)$<br>
^(.*\.)?public-trust\.com$<br>
^(.*\.)?secomtrust\.net$<br>
^(.*\.)?amazontrust\.com$<br>
^certificates\.godaddy\.com$<br>
^crl\.ca\.vodafone\.com$<br>
^crl\.buypass\.no$<br>
<!-- note server list: http://uptime.netcraft.com/perf/reports/performance/OCSP and https://isc.sans.edu/crls.html -->
<br>
For Eye-Fi wireless SD cards to connect and upload photos...<br>
^(.*\.)?eye\.fi$<br>
<br>
For reverse DNS lookups, this is a special case for some VPN and Apple software to determine network location...<br>
^.*\.in-addr\.arpa$<br>
^.*\.ip6\.arpa$<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
You can make this keyword up and/or make it specific to your network's domain, for example: allowed.inside.example.com<br>
<br>
Please contact support if you require a device to believe it is on the Internet, even when Internet is not available. 
In some cases domains can either be forced to resolve to a separate site in IIS, 
or the welcome site can be modified to look for domains in the URL and then redirect to the "Success" message. 
Care needs to be taken to avoid breaking other device connectivity (for example text, SMS, voicemail notifications).<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#5">FAQ 5</a> Block everything and allow just a few sites<br>
<a href="full-FAQ.md#121">FAQ 121</a> Useful AuthKeywordsFile additions<br>

<br>
<br>
<br>

<a name="160"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 160: Why DNS Redirector doesn't produce graphical statistics</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Statistics based on DNS filtering don't actually tell you useful information; in fact it's quite misleading...<br>
<br>
Let's say you were trying to see how much time a user spends on Facebook (assuming for the moment that Facebook is allowed on your network). 
If we were to aggregate all the daily log files on the DNS Redirector server and graph the most popular sites, you would see that Facebook 
is very near the top - however that graph doesn't indicate some or all your users are purposefully visiting www.facebook.com in a browser. 
The many DNS lookups for facebook.com are also generated by the thousands of "like this" buttons, or "login with your Facebook account" options 
that appear on many other websites, also many mobile apps will lookup Facebook domains regardless of the user actually using Facebook or not. 
Similarly, if you were to block Facebook, according to the graph it would still be one of the most popular sites, not because people are actually 
getting to it, but because other 3rd part sites are still trying to look it up, even though you can't visit it. 
The same is true for other sites that use a 3rd party CDN, or incorporate buttons like "tweet this" or "share this" or "blog this" ? all of those 
stats would be inflated, and not representing user visits.<br>
<br>
Another example is let's say you were trying to determine how long a user was on reddit.com in a browser. 
DNS would be queried initially when the user first visits the site, but you have no way to correlate the next lookup to persistent user activity. 
A user's machine may lookup the reddit.com domain, and then not look it up again for a long time, perhaps because they are just sitting on a 
particular page or reading an article. When they close the browser there is no feedback via DNS they are "done" browsing. Refreshing a page on the site, 
or navigating to a different one won't always trigger another DNS lookup due to different browser's internal DNS cache or the OS DNS cache.<br>
<br>
These so called "gaps" in the DNS lookups can also be exacerbated by internal DNS server cache, if that server then forwards DNS onto your DNS Redirector server.<br>
<br>
Since server-wide graphical statistics can't provide insight as to which user is using which sites most frequently, 
what you really want to see is the daily log file. This way you can watch in real time, or reverse engineer, a particular IP's (end-user device) 
DNS activity over the course of the day.<br>
<br>
See sample reporting files in the C:\DNSREDIR\Reporting directory.<br>
<br>
With DNS Redirector software running inside your network the logfile can provide the private IPs of end-user devices (laptop, desktop PC, phone, tablet, etc.)<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#71">FAQ 71</a> Useful 3rd party links<br>
<a href="full-FAQ.md#111">FAQ 111</a> Using Log Parser with DNS Redirector<br>
<a href="full-FAQ.md#97">FAQ 97</a> Query the number of clients online via DNS<br>
<a href="full-FAQ.md#157">FAQ 157</a> Monitor your DNS Redirector server with PRTG<br>

<br>
<br>
<br>

<a name="161"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 161: Dynamic DNS block list no longer includes URL redirect services</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
After Mar 30, 2014 the "Dynamic DNS" list no longer includes domains offering URL redirect/forward/shortening services.<br>
<br>
These domains are used by many legitimate services; often to reduce the length of a link (tweeting), 
copy/pasting links to others ("share" links), newsletters (bulk email), and more.<br>
<br>
When these services are abused by people with bad intentions; if the redirect were to go to a known bad site, 
a DNS lookup would occur for that bad site, and then still be blocked.<br>
<br>
To continue blocking URL redirect services you could add these domains to your blocked.txt file, or if using <a href="full-FAQ.md#52">updater.exe</a> to your blocked-custom.txt file.<br>
Example sources...<br>
<a target="_blank" href="http://mirror1.malwaredomains.com/files/url_shorteners.txt">malwaredomains.com/files/url_shorteners.txt</a><br>
<a target="_blank" href="http://longurl.org/services">longurl.org/services</a><br>
<a target="_blank" href="http://www.vanityurlshorteners.com">vanityurlshorteners.com</a><br>

<br>
<br>
<br>

<a name="162"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 162: Special considerations for Apple devices</h3><font size=1>Category: Troubleshooting</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Do not use a DNS suffix ending in .local if your network has devices running Apple iOS.<br>
<br>
If a .local domain is required to reach (or included within) your welcome, blocked, or other pages used by DNS Redirector 
you will experience trouble reaching those pages or toggling the device as authorized or bypassing the block.<br>
<br>
See: <a target="_blank" href="http://support.apple.com/kb/ts3389">Apple kb/ts3389</a><br>

<br>
<br>
<br>

<a name="163"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 163: Force Google SafeSearch or no SSL</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
To enforce Google SafeSearch... (this is now referred to as SafeSearch VIP)<br>
Go to a command prompt:&nbsp; ping forcesafesearch.google.com<br>
&nbsp;&nbsp; ...see the IP address it resolves to, at the time this article was updated the IP was: 216.239.38.120<br>
So you would add a line to your SimpleDNS=simpledns.txt file like this...<br>
216.239.38.120 www.google.com<br>
216.239.38.120 www.google.ca<br>
&nbsp;&nbsp; ...you need to do this for <a target="_blank" href="https://www.google.com/supported_domains">every Google ccTLD</a> (such as .ca) that your users may visit. Optionally use DNS Redirector to <a href="full-FAQ.md#106">block all other ccTLDs</a>.<br>
<br>
Note: You can use SafeSearch as described above, or the no SSL as described below, but NOT both.<br>
To enforce Google Search without SSL (not an HTTPS site)...<br>
Go to a command prompt:&nbsp; ping nosslsearch.google.com<br>
&nbsp;&nbsp; ...see the IP address it resolves to, at the time this article was updated the IP was: 216.239.32.20<br>
So you would add a line to your SimpleDNS=simpledns.txt file like this...<br>
216.239.32.20 www.google.com<br>
<br>
To restrict which YouTube videos are viewable by users on your network/in your G Suite organization...<br>
For Strict Restricted YouTube access:&nbsp; ping restrict.youtube.com&nbsp;&nbsp;&nbsp; ...at the time this article was updated the IP was: 216.239.38.120<br>
or Moderate Restricted YouTube access:&nbsp; ping restrictmoderate.youtube.com&nbsp;&nbsp;&nbsp; ...at the time this article was updated the IP was: 216.239.38.119<br>
Note: You can use Strict or Moderate, but NOT both.<br>
So you would add the following lines to your SimpleDNS=simpledns.txt file like this...<br>
216.239.38.120 www.youtube.com<br>
216.239.38.120 m.youtube.com<br>
216.239.38.120 youtubei.googleapis.com<br>
216.239.38.120 youtube.googleapis.com<br>
216.239.38.120 www.youtube-nocookie.com<br>
<br>
Note: Before this change takes effect you will need to close all Internet browsers and <a href="full-FAQ.md#12">flush the DNS cache</a><br>
<br>
Note: When using the 1st option, Google SafeSearch (with SSL), this means multiple Google products (gmail, drive, docs) 
will now use that IP as their endpoint. If you have load-balanced or multiple WAN links you might need to add this IP 
to your SSL persistence rules. For Peplink see <a target="_blank" href="http://www.peplink.com/knowledgebase/utilizing-ssl-persistence-with-e-banking-and-other-secure-websites/">this article</a>.<br>
<br>
See: Google Help <a target="_blank" href="https://support.google.com/websearch/answer/186669?hl=en">186669 (Option 3)</a> and <a target="_blank" href="https://support.google.com/youtube/answer/6214622?hl=en">6214622</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#167">FAQ 167</a> Force Bing SafeSearch or Classroom<br>

<br>
<br>
<br>

<a name="164"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 164: Set different DNS servers via DHCP MAC filtering</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Using a DHCP policy can allow some users to browse the Internet without the restrictions imposed by DNS Redirector.<br>
<br>
This is one way to assign different DNS servers to different users.<br>
<h4>Resolution</h4>
See <a target="_blank" href="http://blogs.technet.com/b/teamdhcp/archive/2012/09/15/scope-level-link-layer-filtering-using-dhcp-policies-in-windows-server-2012.aspx">Scope-level Link layer filtering using DHCP Policies in Windows Server 2012/2016</a><br>
<br>
Create at least two DHCP scopes, one using your internal DNS server (the same IP specified for DNSServerIP= in dnsredir.ini)<br>
and the other using the DNS Redirector service IP (the same IP specified for ListenOnIP= in dnsredir.ini)<br>
Note: You may need to reduce the size of your current pool of addresses, in order to leave some for the second pool. The same IP cannot exist in both scopes.<br>
Then apply a new policy under each scope that allows or denies a certain MAC address from obtaining an IP from that scope.<br>
<br>
You could also use this method to assign different DNS Redirector instances to different devices, thereby creating different filtering policies.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#77">FAQ 77</a> Logon script integration<br>
<a href="full-FAQ.md#92">FAQ 92</a> Set different DNS servers via Group Policy<br>

<br>
<br>
<br>

<a name="165"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 165: Use DHCP option 15 to set a DNS suffix</h3><font size=1>Category: RedirectIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
The ability to display a welcome page before the user's device can get Internet access (captive portal) does not work on some client devices 
unless a DNS suffix is defined for the network. 
Some Apple iOS and Android versions will not detect the presence of a captive portal and simply report Internet is broken/not working, unless the network DHCP server provides a DNS suffix.<br>
<h4>Resolution</h4>
For Windows server...<br>
Administrative Tools > DHCP > Expand server name > Expand IPv4<br>
Select: Server Options, right-click: Configure Options...<br>
Pick: 015 DNS Domain Name and enter String value: wireless.example.com<br>
You may also need to do this under the active DHCP Scope<br>
<br>
For Zywall USG series...<br>
Under Interface (LAN1 for example)<br>
DHCP Setting<br>
Extended Options<br>
&nbsp;&nbsp; Option: User Defined<br>
&nbsp;&nbsp; Name: domain-suffix<br>
&nbsp;&nbsp; Code: 15<br>
&nbsp;&nbsp; Type: Text<br>
&nbsp;&nbsp; Value: wireless.example.com<br>
<br>
For Peplink Balance series...<br>
LAN > DHCP Server Settings<br>
Extended DHCP Option<br>
&nbsp;&nbsp; Option: 15. DNS Domain Name<br>
&nbsp;&nbsp; Value: wireless.example.com<br>

<br>
<br>
<br>

<a name="166"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 166: Not all sites are blocked correctly</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
Sites that you expect to be blocked are not blocked.<br>
<h4>Resolution</h4>
 - Check that your AllowedKeywordsFile= does not contain a keyword that is overriding your BlockedKeywordsFile=<br>
To assist in finding this problem set Logging=Full in dnsredir.ini, re/start the software, then scroll to the bottom of today's log file for more information.<br>
<br>
 - Disable IPv6 on the client device and/or turn off any IPv6 DHCP server on the network<br>
If an IPv6 DNS server is reachable, it will resolve queries ahead of DNS Redirector on IPv4. 
Otherwise you will need to assign a valid IPv6 address to the DNS Redirector server, and for ListenOnIP= in dnsredir.ini, 
and set that IPv6 address as the default DNS server that clients will use. 
Note that IPv6 is often safe to disable, your computer will use <a target="_blank" href="https://en.wikipedia.org/wiki/Teredo_tunneling">Teredo</a> 
to reach IPv6 sites (ensure that UDP port 3544 is open outbound for Teredo to function)<br>
<br>
All keyword lists need to have at least one non-regex keyword present; at least 1 line not starting with ^<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#51">FAQ 51</a> Everything is allowed, but that is not my intention<br>
<a href="full-FAQ.md#169">FAQ 169</a> Length of the URL for this request error<br>

<br>
<br>
<br>

<a name="167"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 167: Force Bing SafeSearch or Classroom</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
To block potentially explicit images and video content...<br>
Add the following keyword to your blocked.txt file, or if using updater.exe to your blocked-custom.txt file.<br>
explicit.bing.net<br>
<br>
To enforce Bing SafeSearch...<br>
Go to a command prompt:&nbsp; ping strict.bing.com<br>
&nbsp;&nbsp; ...see the IP address it resolves to, at the time this article was updated the IP was: 204.79.197.220<br>
So you would add a line to your SimpleDNS=simpledns.txt file like this...<br>
204.79.197.220 www.bing.com<br>
<br>
Note: You can use SafeSearch as described above, or Classroom as described below, but NOT both.<br>
To enforce Bing in the Classroom...<br>
Go to a command prompt:&nbsp; ping classroom.bing.com<br>
&nbsp;&nbsp; ...see the IP address it resolves to, at the time this article was updated the IP was: 204.79.197.226<br>
So you would add a line to your SimpleDNS=simpledns.txt file like this...<br>
204.79.197.226 www.bing.com<br>
<br>
Note: Before this change takes effect you will need to close all Internet browsers and <a href="full-FAQ.md#12">flush the DNS cache</a><br>
<br>
See: Bing documents <a target="_blank" href="https://blogs.bing.com/search/2009/06/12/safe-search-update">here</a>, 
<a target="_blank" href="http://help.bing.microsoft.com/#apex/18/en-US/10003/0">here</a>, and 
<a target="_blank" href="http://hostme.blob.core.windows.net/images/bex/bic/docs/Bing%20in%20the%20Classroom%20-%20Admin%20Sign%20Up%20Steps%20-%20O365.pdf">here</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#163">FAQ 163</a> Force Google SafeSearch or no SSL<br>

<br>
<br>
<br>

<a name="168"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 168: Microsoft .NET optimization high CPU</h3><font size=1>Category: Everything else</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
You may notice ngen.exe or mscorsvw.exe running and taking up allot of CPU, this is normal especially after installing .NET Framework for the first time or a .NET update.<br>
<br>
However, on some systems this may prevent DNS Redirector from running or starting fully, until the optimization service completes.<br>
<br>
For more information about these Microsoft executables, including how you can speed up the process, <a target="_blank" href="https://blogs.msdn.microsoft.com/dotnet/2013/08/06/wondering-why-mscorsvw-exe-has-high-cpu-usage-you-can-speed-it-up/">see here</a>.<br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#108">FAQ 108</a> Microsoft .NET Framework is required<br>

<br>
<br>
<br>

<a name="169"><hr style="border: 1px; height: 1px; background: #AAAAAA;"><h3>FAQ 169: Length of the URL for this request error</h3><font size=1>Category: BlockedIP function</font></a><br>
<hr style="border: 1px; height: 1px; background: #AAAAAA;"><br>
In some cases the Blocked site may display an error "The length of the URL for this request exceeds the configured maxUrlLength value"<br>
<br>
This is because the default IIS setting of 260 is shorter than the URL being blocked.<br>
Note that the content is blocked regardless, it's only the blocked site does not display properly in the end-user browser.<br>
<h4>Resolution</h4>
On your IIS server which hosts the blocked site, download: <a href="https://drive.google.com/drive/folders/1lMxuJpa2z43nnDBOQoBmeGVOdbOvGOcx">REG-UrlSegmentMaxLength.zip</a> then open the .reg file.<br>
<br>
In the root of the blocked site find the "web.config" file and edit using notepad<br>
Modify the system.web section to include the two httpRuntime declarations as shown below...<br>
<br>
<textarea rows="5" cols="80">
<system.web>
  <customErrors mode="On" defaultRedirect="blocked.asp" />
  <httpRuntime maxUrlLength="500" />
  <httpRuntime requestValidationMode="2.0" />
</system.web>
</textarea><br>
<br>
Our suggestion for both the registry edit and the web.config file is to set the length at 500, however a value up to 2048 also works.<br>
<br>
Also see...<br>
<a target="_blank" href="https://support.microsoft.com/en-us/help/820129/http.sys-registry-settings-for-windows">UrlSegmentMaxLength registry setting</a><br>
<a target="_blank" href="https://stackoverflow.com/questions/3884659/maxrequestpathlength-not-in-asp-net-4-documentation-and-doesnt-work">maxRequestPathLength setting does not work</a><br>
<a target="_blank" href="https://www.saotn.org/the-length-url-request-exceeds-configured-maxurllength-value/">maxUrlLength setting in web.config</a><br>
<a target="_blank" href="https://docs.microsoft.com/en-us/iis/configuration/system.webServer/security/requestFiltering/requestLimits/">IIS request limits</a><br>
<br><b>Related articles</b><br>
<a href="full-FAQ.md#166">FAQ 166</a> Not all sites are blocked correctly<br>

<br>
<br>
[End of Line]
